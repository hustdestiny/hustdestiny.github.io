<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Destiny</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Destiny">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Destiny">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Destiny">
  
    <link rel="alternate" href="/atom.xml" title="Destiny" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Destiny</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-iOSä¸­çš„é”" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/26/iOSä¸­çš„é”/" class="article-date">
  <time datetime="2018-04-26T12:11:20.000Z" itemprop="datePublished">2018-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/26/iOSä¸­çš„é”/">iOSä¸­çš„é”</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>é¦–å…ˆå®¢è§‚çš„æ¥è¯´å¹³æ—¶çš„å·¥ä½œä¸­å¯¹é”çš„ç†è§£å¹¶ä¸æ˜¯å¾ˆæ·±åˆ»ï¼Œåªæ˜¯åœ¨ä¹‹å‰é¢è¯•çš„æ—¶å€™ç®€å•äº†è§£è¿‡ï¼Œé”çš„ç”¨å¤„ä¸»è¦æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ­»é”çš„åœºæ™¯ã€‚</p>
<ol>
<li>åˆæ¬¡æ¥è§¦çš„æ—¶å€™æ˜¯åœ¨å±æ€§å…³é”®å­—ä¸­ã€‚nonatomic<br>ç³»ç»Ÿä¼šåœ¨setterå’Œgetterçš„æ–¹æ³•ä¸­åŠ é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ“ä½œå€¼ç±»å‹é‚£ä¹ˆOKæ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ“ä½œä¸€ä¸ªMutableArray,é‚£ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸æ˜¯å»setæˆ–è€…getè¿™ä¸ªarra,è€Œæ˜¯å»addæˆ–è€…removeè¿™ä¸ªå®¹æ˜“ï¼Œæ‰€ä»¥è¿™ä¸ªé”å¹¶æ²¡æœ‰å·¦å³ã€‚é”åªæ˜¯ä¿è¯äº†è¿™ä¸ªæŒ‡é’ˆå˜é‡æœ¬èº«ï¼Œå´ä¸ä¿è¯å…¶æŒ‡å‘çš„å†…å®¹çº¿ç¨‹å®‰å…¨<br>ã€‚</li>
<li><p>åæ¥åœ¨é¡¹ç›®ä¸­çœ‹è§æœ‰åŒå­¦ä½¿ç”¨ @synchronized (self)çš„å†™æ³•</p>
</li>
<li><p>åæ¥ä¹Ÿçœ‹è§è¿‡NSLock</p>
</li>
<li><p>ç›´åˆ°ä»Šå¤©çœ‹SDWebImageçš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªå®å®šä¹‰ï¼Œæˆ‘è§‰å¾—ä¸æ€»ç»“ä¸€ä¸‹ï¼Œè¯´ä¸è¿‡å»äº†å“ˆã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCK(lock) dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLOCK(lock) dispatch_semaphore_signal(lock);</span></span><br><span class="line"></span><br><span class="line">lock = dispatch_semaphore_create(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>atomic<br>dispatch_semaphore_t<br>pthread_mutex<br>pthread_mutex(recursive)<br>NSLock æ˜¯å¯¹pthread_mutexçš„å°è£…ï¼Œä¸»è¦æ€§èƒ½å·®åˆ«åœ¨ç”¨æ–¹æ³•è°ƒç”¨å¯¼è‡´ï¼Œå…¶å®å¹¶ä¸å¤§<br>NSCondition<br>NSRecursiveLock<br>NSConditionLock<br>@synchronized è¿™ä¸ªåé¢åªéœ€è¦ä¼ é€’ä¸€ä¸ªOCå¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¯¹è±¡å½“æˆé”æ¥ä½¿ç”¨ï¼Œå¹¶ä¸æ˜¯é”ä½è¿™ä¸ªå¯¹è±¡çš„æ„æ€ï¼ˆåæ­£æˆ‘ä¹‹å‰æ˜¯ç†è§£æˆé”ä½æ•´ä¸ªselfäº†ï¼Œæ‰‹åŠ¨æ»‘ç¨½ï¼‰</p>
<p>ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿwhileå¿™ç­‰ï¼Œæ³¨æ„ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ï¼ˆä½ä¼˜å…ˆçº§çº¿ç¨‹æ‹¿åˆ°é”ï¼Œé«˜ä¼˜å…ˆçº§busy-waitæ¶ˆè€—CPUæ—¶é—´ï¼Œå¯¼è‡´ä½ä¼˜å…ˆçº§çº¿ç¨‹æ‹¿ä¸åˆ°CPUæ—¶é—´ï¼Œæ— æ³•å®Œæˆä»»åŠ¡æ— æ³•é‡Šæ”¾é”ï¼‰</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> lock = <span class="literal">false</span>; <span class="comment">// ä¸€å¼€å§‹æ²¡æœ‰é”ä¸Šï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥ç”³è¯·é”  </span></span><br><span class="line"><span class="keyword">do</span> &#123;  </span><br><span class="line">    <span class="keyword">while</span>(lock); <span class="comment">// å¦‚æœ lock ä¸º true å°±ä¸€ç›´æ­»å¾ªç¯ï¼Œç›¸å½“äºç”³è¯·é”</span></span><br><span class="line">    lock = <span class="literal">true</span>; <span class="comment">// æŒ‚ä¸Šé”ï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹å°±æ— æ³•è·å¾—é”</span></span><br><span class="line">        Critical section  <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    lock = <span class="literal">false</span>; <span class="comment">// ç›¸å½“äºé‡Šæ”¾é”ï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒº</span></span><br><span class="line">        Reminder section <span class="comment">// ä¸éœ€è¦é”ä¿æŠ¤çš„ä»£ç         </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»€ä¹ˆæ˜¯äº’æ–¥é”ï¼Ÿpthread_mutex<br>PTHREAD_MUTEX_NORMAL<br>PTHREAD_MUTEX_ERRORCHECK==&gt;NSLock<br>PTHREAD_MUTEX_RECURSIVE==&gt;NSRecursiveLock</p>
<p>ä»€ä¹ˆæ˜¯é€’å½’é”ï¼Ÿé€’å½’é”åœ¨è¢«åŒä¸€çº¿ç¨‹é‡å¤è·å–æ—¶ä¸ä¼šäº§ç”Ÿæ­»é” NSRecursiveLock @synchronized<br>ä»€ä¹ˆæ˜¯ä¿¡å·é‡ï¼Ÿ<br>åŸç†æ˜¯é¦–å…ˆå°†ä¿¡å·é‡å‡1ï¼Œåˆ¤æ–­æ˜¯å¦å¤§äº0ï¼Œå¤§äº0åˆ™æ— éœ€ç­‰å¾…ç›´æ¥ï¼Œåä¹‹åˆ™ä½¿çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè®©å‡ºæ—¶é—´ç‰‡ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sem_wait</span> <span class="params">(<span class="keyword">sem_t</span> *sem)</span> </span>&#123;  </span><br><span class="line">  <span class="keyword">int</span> *futex = (<span class="keyword">int</span> *) sem;</span><br><span class="line">  <span class="keyword">if</span> (atomic_decrement_if_positive (futex) &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> err = lll_futex_wait (futex, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3 id="æ­»é”åœºæ™¯"><a href="#æ­»é”åœºæ™¯" class="headerlink" title="æ­»é”åœºæ™¯"></a>æ­»é”åœºæ™¯</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@<span class="string">"1"</span>); <span class="comment">// ä»»åŠ¡1</span></span><br><span class="line">dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"2"</span>); <span class="comment">// ä»»åŠ¡2</span></span><br><span class="line">&#125;);</span><br><span class="line">NSLog(@<span class="string">"3"</span>); <span class="comment">// ä»»åŠ¡3</span></span><br></pre></td></tr></table></figure>
<ol>
<li>é¦–å…ˆåœ¨ä¸»çº¿ç¨‹ä¸­ ä»»åŠ¡1æ¯«æ— ç–‘é—®è‚¯å®šæ‰§è¡Œã€‚</li>
<li>æ¥ç€æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼Œå•çº¿ç¨‹ä¸­åŒæ­¥ï¼Œå°†ä»»åŠ¡2æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—çš„æœ«å°¾ã€‚åœ¨ä¸»é˜Ÿåˆ—ä¸­ head-ä»»åŠ¡1-åŒæ­¥å‡½æ•°-ä»»åŠ¡3-ä»»åŠ¡2-tailã€‚</li>
<li>ä»»åŠ¡3éœ€è¦ç­‰å¾…åŒæ­¥å‡½æ•°è¿”å›æ‰ä¼šæ‰§è¡Œã€‚ä»»åŠ¡2ä¹Ÿå¾—ç­‰å¾…ä»»åŠ¡3æ‰§è¡Œå®Œã€‚ç›¸äº’ç­‰å¾…æ­»é”ã€‚</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/26/iOSä¸­çš„é”/" data-id="ckbnff0xx000nlwj72t5kx2y7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SDWebImageæºç å­¦ä¹ " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/17/SDWebImageæºç å­¦ä¹ /" class="article-date">
  <time datetime="2018-04-17T09:34:22.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/17/SDWebImageæºç å­¦ä¹ /">SDWebImageæºç å­¦ä¹ </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>åœ¨åˆšåˆšæ¥è§¦iOSçš„æ—¶å€™å°±å¬è¯´SDWebImageçš„å¤§åï¼Œåœ¨ç¬¬ä¸€å®¶é¢è¯•çš„æ—¶å€™ä¹Ÿè¢«é—®åˆ°è¿‡è¿™ä¸ªåº“çš„é—®é¢˜ï¼Œåæ¥æˆ–å¤šæˆ–å°‘çš„è¯»è¿‡å…¶æºç ã€‚å¦‚ä»Šä½œä¸ºä¸€ä¸ªDeveloperå·²ç»ä¸‰å¹´äº†ï¼Œæ¥å¥½å¥½æ€»ç»“ä¸€ä¸‹è¿™ä¸ªOCStarç¬¬äºŒåã€‚</p>
<p>é¦–å…ˆåœ¨å¿ƒä¸­é—®ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ä¸ªåº“ï¼Ÿä¹Ÿè®¸æ˜¯å› ä¸ºä»–åæ°”å¾ˆå¤§Starå¾ˆå¤šï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºåŸæ¥é¡¹ç›®ä¸­å°±ä½¿ç”¨äº†è¿™ä¸ªåº“ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºé¢è¯•è¢«è™çŸ¥é“äº†è¿™ä¸ªåº“ã€‚</p>
<p>ä»–è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<ol>
<li>ä¸‹è½½ç½‘ç»œå›¾ç‰‡</li>
<li>Cellä¸­å¤ç”¨é—®é¢˜</li>
<li>å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜</li>
<li>å¼ºåˆ¶è§£ç ï¼Œå¢åŠ æ¸²æŸ“é€Ÿåº¦</li>
</ol>
<p>æ­£å¸¸æ¥è¯´æˆ‘ä»¬éƒ½æ˜¯ä»UIImageView+WebCache.hè¿™ä¸ªæ–‡ä»¶å¼€å§‹çš„</p>
<p>è¿™ä¸ªApiæ˜¯æˆ‘ä¸ªäººä½¿ç”¨æœ€å¤šçš„äº†ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯è°ƒç”¨ä¸‹é¢è¿™ä¸ªapi<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)sd_setImageWithURL:(nullable NSURL *)url placeholderImage:(nullable UIImage *)placeholder</span><br></pre></td></tr></table></figure></p>
<p>ä¸€å±‚ä¸€å±‚ç‚¹è¿›å»ï¼Œå†…éƒ¨è°ƒç”¨äº†UIViewçš„ä¸€ä¸ªCategoryçš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)sd_internalSetImageWithURL:(nullable NSURL *)url</span><br><span class="line">                  placeholderImage:(nullable UIImage *)placeholder</span><br><span class="line">                           options:(SDWebImageOptions)options</span><br><span class="line">                      operationKey:(nullable NSString *)operationKey</span><br><span class="line">                     setImageBlock:(nullable SDSetImageBlock)setImageBlock</span><br><span class="line">                          progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class="line">                         completed:(nullable SDExternalCompletionBlock)completedBlock</span><br><span class="line">                           context:(nullable NSDictionary&lt;NSString *, id&gt; *)context;</span><br></pre></td></tr></table></figure>
<p>å…ˆåˆ«æ™•ï¼Œå½“ä¸€ä¸ªæ¡†æ¶æš´éœ²çš„æ¥å£è¶Šæ˜¯ç®€å•ï¼Œçµæ´»ï¼Œä»–çš„å†…éƒ¨ä¸€å®šæ˜¯å¤æ‚çš„ã€‚å› ä¸ºä»–å¸®ä½ åšäº†é‚£äº›ä½ è¯¥åšçš„å·¥ä½œã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¾ˆé•¿çš„ï¼Œè™½ç„¶è¿™ä¸ç¬¦åˆæˆ‘çš„50linesçš„è§„çŸ©ï¼Œä½†æ˜¯è§„çŸ©æ˜¯äººå®šçš„ã€‚</p>
<ol>
<li>ç¬¬ä¸€æ­¥å…ˆå–è¿™ä¸ªoperationKeyï¼Œæ­£å¸¸æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™å¹¶ä¸ä¼šè®¾ç½®è¿™ä¸ªï¼Œæ‰€ä»¥å®ƒé»˜è®¤åº”è¯¥æ˜¯ä¸€ä¸ª@â€UIImageViewâ€çš„å­—ç¬¦ä¸²</li>
<li>cancelæ‰å½“å‰è¿™ä¸ªUIImageViewä¸Šæ­£åœ¨ä¸‹è½½çš„å›¾ç‰‡ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¸ªUIView lazyçš„æ–¹å¼å…³è”ä¸€ä¸ªNSMapTable(ç›¸å½“äºæ˜¯å­—å…¸)ï¼Œå­—å…¸çš„keyå…¶å®è¿™å°±æ˜¯ç±»åï¼Œvalueä¸ºä¸‹è½½çš„operationï¼Œè¿™ä¸ªoperationå°±æ˜¯å¯ä»¥cancelçš„, canceläº†ä¹‹åå†å»ä¸‹è½½ä¸‹ä¸€å¼ å›¾ç‰‡ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°ä¸€äº›å¤ç”¨å¯¼è‡´çš„bugã€‚ï¼ˆæœ€ç»å…¸çš„å…ˆä¸‹è½½çš„å›¾ç‰‡ï¼Œå› ä¸ºç½‘ç»œåä¸‹è½½å®Œæˆï¼Œè¦†ç›–ä¸Šå»å¯¼è‡´é”™ä¹±ï¼‰</li>
<li>æŠŠå›¾ç‰‡çš„åœ°å€ä¹Ÿå…³è”åˆ°è¿™ä¸ªUIViewä¸Šå»</li>
<li>åˆ¤æ–­optionsä¸­æ˜¯å¦æœ‰å»¶è¿Ÿplaceholderçš„è®¾ç½®é¡¹ï¼Œæ²¡æœ‰çš„è¯å°±å»è®¾ç½®placeholderï¼Œå½“ç„¶è¿™å…¶ä¸­æœ‰ä¸€ä¸ªgroup å’Œ ä¸»çº¿ç¨‹çš„å†…å®¹ï¼Œå…ˆæ”¾ä¸€æ”¾</li>
<li>åˆ¤æ–­url urlä¸ºç©ºåˆ™ç§»é™¤indicator, æ‰§è¡ŒcompletedBlockæŠ›å‡ºé”™è¯¯</li>
<li>urlä¸ä¸ºç©ºï¼Œæ ¹æ®éœ€è¦æ˜¾ç¤ºindicatorã€‚</li>
<li>é‡ç½®å›¾ç‰‡ä¸‹è½½è¿›åº¦</li>
<li>å°è¯•ä»ä¸Šä¸‹æ–‡ä¸­è·å–manager, æˆ–è€…å–å•ä¾‹çš„sharedManager</li>
<li>è®¾ç½®ä¸€ä¸ªprogressçš„block</li>
<li>manageræ ¹æ®url optionsç­‰å‚æ•°å»ä¸‹è½½å›¾ç‰‡ï¼Œå¹¶è¿”å›ä¸€ä¸ªoperaionå¯¹è±¡,å°†è¿™ä¸ªå¯¹è±¡setåˆ°å…³è”çš„NSMapTableä¸­å»ã€‚</li>
<li>è¿™é‡Œçš„weak strong danceã€‚é¦–å…ˆæ£€æŸ¥sselfï¼Œå¤šçº¿ç¨‹çš„æƒ…å†µå¯èƒ½é‡Šæ”¾ï¼Œç§»é™¤indicator,è®¾ç½®progressçš„å¼‚å¸¸æƒ…å†µ</li>
<li>æ ¹æ®options,ä¸ç¦æ­¢è‡ªåŠ¨è®¾ç½®å›¾ç‰‡ï¼Œå»¶è¿Ÿè®¾ç½®placeholderï¼ŒsetNeedsLayout</li>
<li>è®¾ç½®image, å’Œ imageData</li>
<li>è®¾ç½®imageViewçš„image,æ‰§è¡ŒcompletedBlock</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (id &lt;SDWebImageOperation&gt;)loadImageWithURL:(nullable NSURL *)url</span><br><span class="line">                                     options:(SDWebImageOptions)options</span><br><span class="line">                                    progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class="line">                                   completed:(nullable SDInternalCompletionBlock)completedBlock</span><br></pre></td></tr></table></figure>
<ol>
<li>æ£€æŸ¥æ˜¯å¦completedBlock</li>
<li>æ£€æŸ¥URLçš„å‚æ•°ç±»å‹ã€‚NSStringï¼ŒNSURL</li>
<li>åˆ›å»ºä¸€ä¸ªoperationï¼Œè®¾ç½®ä»–çš„managerä¸ºå•ä¾‹</li>
<li>çœ‹url æ˜¯å¦ä¸ºå¤±è´¥çš„url</li>
<li>ç»å¯¹urlä¸å­˜åœ¨ï¼Œæˆ–è€…ï¼ˆæ˜¯å¤±è´¥çš„urlä¸”ä¸é‡è¯•ï¼‰, è°ƒç”¨å®Œæˆï¼Œå¹¶è¿”å›operation</li>
<li>åŠ é”å¹¶å¾€runningOperationsä¸­å¢åŠ ä¸€ä¸ªoperation</li>
<li>è·å–cacheKey</li>
<li>è·å–cacheOptions, æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„ä½æ“ä½œï¼Œå­¦ä¹ äº†get</li>
<li><p>é€šè¿‡imageCache è·å¾—ä¸€ä¸ªcacheOperaionå¯¹è±¡ï¼Œ</p>
<ol>
<li>cacheå®Œæˆä¹‹åçš„å›è°ƒé‡Œï¼Œé¦–å…ˆæ˜¯weak strong dance</li>
<li>åˆ¤ç©ºï¼Œæˆ–è€…å·²ç»å–æ¶ˆçš„æƒ…å†µä¸‹ä»runningä¸­ç§»é™¤, return</li>
<li>æ ¹æ®optionsåˆ¤æ–­æ˜¯å¦éœ€è¦ä¸‹è½½ï¼Œelse ifæœ‰cacheImageçš„æƒ…å†µï¼Œelse æ²¡æœ‰cacheå¹¶ä¸”è¢«delegate cancelçš„æƒ…å†µ</li>
<li>å¦‚æœcacheä¸­æ‰¾åˆ°äº†å¯¹åº”çš„å›¾ç‰‡ï¼Œä½†æ˜¯optionsä¸­æ˜¯refreshCacheçš„è®¾ç½®ï¼Œé¦–å…ˆé€šçŸ¥ä¸€ä¸‹å¤–éƒ¨cacheType</li>
<li>è®¾ç½®downloadOperations</li>
<li><p>è®¾ç½®operationçš„downloadToken</p>
<ol>
<li>ä¸‹è½½å®Œæˆä¹‹ååˆ¤ç©ºï¼Œåˆ¤cancel</li>
<li>åˆ¤æ–­é”™è¯¯ï¼Œè®°å½•é”™è¯¯</li>
<li>ä¸‹è½½æˆåŠŸæ ¹æ®options ç§»é™¤é”™è¯¯</li>
<li>æ ¹æ®options æ˜¯å¦ä¿å­˜åˆ°disk</li>
<li>scaledImageForKey</li>
<li>æ ¹æ®ä¸åŒçš„case å»storeImage</li>
<li>ç§»é™¤operation</li>
</ol>
</li>
</ol>
</li>
<li><p>returnè¿™ä¸ªoperation</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nullable NSOperation *)queryCacheOperationForKey:(nullable NSString *)key options:(SDImageCacheOptions)options done:(nullable SDCacheQueryCompletedBlock)doneBlock &#123;</span><br></pre></td></tr></table></figure>
<ol>
<li>åˆ¤æ–­key</li>
<li>ä»å†…å­˜ä¸­å¯»æ‰¾image</li>
<li>ä»diskä¸­å¯»æ‰¾diskData</li>
<li>ä»diskDataâ€“&gt;diskImage(åˆ›å»ºï¼Œæ—‹è½¬ï¼Œç¼©æ”¾ï¼Œè§£ç )</li>
<li>å¡åˆ°å†…å­˜ç¼“å­˜ä¸­å»</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (nullable SDWebImageDownloadToken *)downloadImageWithURL:(nullable NSURL *)url</span><br><span class="line">                                                   options:(SDWebImageDownloaderOptions)options</span><br><span class="line">                                                  progress:(nullable SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class="line">                                                 completed:(nullable SDWebImageDownloaderCompletedBlock)completedBlock</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨äº†ä¸€ä¸ªweak</li>
<li>return DownloadToken<br>è¿™æ˜¯å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¥‡æ€ªçš„æ–¹å¼ï¼ŒcreateCallback,åˆ›å»ºrequest, è®¾ç½®å„ç§å‚æ•°åˆ›å»ºè‡ªå®šä¹‰çš„operation</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (nullable SDWebImageDownloadToken *)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class="line">                                           completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock</span><br><span class="line">                                                   forURL:(nullable NSURL *)url</span><br><span class="line">                                           createCallback:(SDWebImageDownloaderOperation *(^)(void))createCallback</span><br></pre></td></tr></table></figure>
<ol>
<li>åˆ¤æ–­url</li>
<li>åŠ é”ï¼Œå–å‡ºoperation,å¦‚æœæ²¡æœ‰å°±åˆ›å»ºoperation,è®¾ç½®ä¸€ä¸ªå®Œæˆçš„å›è°ƒï¼Œå°†operationæ·»åŠ åˆ°queueä¸­å»ï¼ŒåŠ å…¥é˜Ÿåˆ—åˆ™å¼€å§‹ä¸‹è½½äº†ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªtoken,å¹¶è¿”å›</li>
</ol>
<p>æ­¤å¤„ï¼Œå¤šçº¿ç¨‹çš„è‡ªå®šä¹‰operationæ“ä½œå¾ˆæ£’ï¼å€¼å¾—æ·±å…¥å­¦ä¹ ï¼</p>
<p>è¿™å…¶ä¸­<br>SDWebImageDownloader ==== AFHTTPSessionManager<br>SDWebImageDownloaderOperation ===== AFURLSessionManagerTaskDelegate</p>
<p>å…¶ä¸­AFNetworkingä¸­æ˜¯ç»´æŠ¤äº†ä¸€ä¸ªå¯å˜å­—å…¸ï¼ŒSDWebImageä¸­æ˜¯éå†downQueueä¸­çš„operation, æœ€ç»ˆä½¿ç”¨çš„éƒ½æ˜¯dataTaskIdentifiter,ç›´è§‚æ„Ÿè§‰è¿˜æ˜¯å­—å…¸æ›´å¿«ä¸€äº›ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/17/SDWebImageæºç å­¦ä¹ /" data-id="ckbnff0xr000hlwj7v42vz4km" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Autolayoutå­¦ä¹ ç¬”è®°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/11/Autolayoutå­¦ä¹ ç¬”è®°/" class="article-date">
  <time datetime="2018-03-11T06:48:11.000Z" itemprop="datePublished">2018-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/11/Autolayoutå­¦ä¹ ç¬”è®°/">Autolayoutå­¦ä¹ ç¬”è®°</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>é¦–å…ˆè¯´ä¸€ä¸‹æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼Œ80%ä¸šåŠ¡UIåº”è¯¥ä»¥IBçš„å½¢å¼ï¼Œ15%åº”è¯¥ç”¨Masnoryçš„æ–¹å¼ï¼Œ5%ä½¿ç”¨frameã€‚IBå‘å±•åˆ°ç›®å‰çš„é˜¶æ®µï¼Œæˆ‘è§‰å¾—å·²ç»ä¸å­˜åœ¨ä»€ä¹ˆå¤šäººåä½œçš„é—®é¢˜äº†ï¼Œæ€§èƒ½æˆ‘è§‰å¾—ä¹Ÿä¸æ˜¯Appçš„ç“¶é¢ˆæ‰€åœ¨ã€‚é—®é¢˜å¯èƒ½åœ¨äºæŸä¸€äº›åŠ¨æ€åˆ›å»ºä¸æ˜¯å¾ˆå¥½å¤„ç†ï¼Œæˆ–è€…æ˜¯å¤§é‡åˆ›å»ºé‡å¤å…ƒç´ çš„æ—¶å€™ï¼ˆæ˜¯ä¸æ˜¯åº”è¯¥ä½¿ç”¨UITableViewæˆ–è€…UICollectionViewå‘¢ï¼‰ã€‚åœ¨æŸä¸€äº›åŠ¨ç”»çš„åœºåˆå¯èƒ½è¿˜æ˜¯frameè¦å¥½ä¸€äº›ã€‚</p>
<ol>
<li><p>Using Code<br>æˆ‘æƒ³ç°åœ¨ä¸»ä½“è¿˜æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼çš„åŒå­¦ï¼Œåº”è¯¥å·²ç»å¾ˆå°‘äº†ï¼Œè¿™ç§æ–¹å¼ç¼ºç‚¹å’Œä¼˜ç‚¹åŒæ ·æ˜æ˜¾ã€‚åœ¨é€‚é…æ–¹é¢ç®€ç›´ä¸å¯åŸè°…ï¼Œä¹Ÿè®¸æœ‰ä¸€äº›åˆ«çš„æ–¹æ³•å¯ä»¥ç¼“è§£ï¼ˆæ¯”å¦‚å®šä¹‰ä¸€ä¸ªå®ï¼Œæ–¹æ³•æ ¹æ®å±å¹•æ¯”åˆ—å»åšç¼©æ”¾ï¼‰ä½†æ˜¯åœ¨appleçˆ¸çˆ¸å·²ç»æä¾›äº†Autolayoutçš„åŸºç¡€ä¸Šä½•å¿…é€†æµå‘¢ï¼Ÿä½†æ˜¯æœ‰ä¸€äº›åŠ¨ç”»åœºæ™¯ï¼Œæ¯”å¦‚æ¶‰åŠåˆ°CALayerçš„åœ°æ–¹ï¼Œæ²¡åŠæ³•ğŸ¤·â€â™€ï¸åªèƒ½æ˜¯frameäº†</p>
</li>
<li><p>Using PureLayout &amp; Masonry/SnapKit<br>è¿™æ˜¯æˆ‘æ¥è§¦iOSä¸€æ¥ä½¿ç”¨çš„æœ€ä¹…çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ç›®å‰å¸‚é¢ä¸Šçš„ä¸»æµå§ã€‚å‰ä¸€ä¸ªæ¡†æ¶å¯èƒ½ä½¿ç”¨è€…å°‘ä¸€äº›ï¼Œåä¸€ä¸ªä»githubçš„staræ’åæ¥è¯´ç»å¯¹æ˜¯ç«çˆ†ã€‚ä½œä¸ºä¹‹å‰çš„çº¯ä»£ç å…šçš„æˆ‘æ¥è¯´ï¼Œè¿™å¥—æ–¹æ¡ˆæ¯”ä»€ä¹ˆVFLé è°±å¾ˆå¤šï¼Œè‡³å°‘ä¸ä¼šå› ä¸ºä¸€ä¸ªtypoæ»¡ä¸–ç•Œæ‰¾åŸå› ï¼Œç›¸æ¯”ä¹‹å‰å†—é•¿çš„ä»£ç æ¥è¯´ï¼Œç®€ç›´å°±æ˜¯ç¦éŸ³ã€‚æ›¾ç»çš„æˆ‘ä»¥ä¸ºåªæœ‰ä»£ç æ•²å‡ºæ¥çš„æ‰æ˜¯æœ€å¥½çš„ï¼Œæ„Ÿè§‰è‡ªå·±æ§åˆ¶äº†æ‰€æœ‰çš„ç»†èŠ‚ã€‚å¯æ˜¯æœ‰ä¸€å¤©æˆ‘ç´¯äº†ï¼Œæ¯å½“å†™èµ·å¤§æ®µçš„UIä»£ç çš„æ—¶å€™ï¼Œå¤´éƒ½æ˜¯å¾ˆç–¼çš„ï¼Œå› ä¸ºè¿˜éœ€è¦èµ·åå­—ã€‚</p>
</li>
<li><p>Using Interface Builder<br>è¿™æ˜¯æˆ‘æœ€è¿‘åœ¨ä½¿ç”¨çš„æ–¹å¼ï¼Œå…¶å®å¾ˆæ—©ä¹‹å‰æˆ‘å°±äº†è§£è¿‡è¿™ä¸ªæ–¹å¼ï¼Œä¸è¿‡ç”±äºä¹‹å‰çš„å›¢é˜Ÿæˆå‘˜ä¸å¤ªèµæˆï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å¼ºè¡Œä½¿ç”¨ã€‚é¦–å…ˆæˆ‘è§‰å¾—è¦æ‹¥æŠ±å˜åŒ–æ‹¥æŠ±æ–°äº‹ç‰©ï¼Œè™½ç„¶æœ‰ç¼ºç‚¹ï¼Œä½†éƒ½ä¸æ˜¯è‡´å‘½çš„ï¼Œä¼˜ç‚¹åœ¨äºå¯è§†åŒ–ï¼Œè¡¨ç°åŠ›å¼ºï¼Œå°±ç®—æ˜¯ä¸ªå¤–è¡Œä¹Ÿèƒ½çœ‹æ‡‚ï¼ŒUIç«™åœ¨ä½ èº«åéƒ½èƒ½è·Ÿä½ èŠä¸¤å¥~~ï¼ˆå‘åšä¸€ç‚¹â€¦å‘å³ä¸€ç‚¹â€¦</p>
</li>
</ol>
<p>è¿™é‡Œæˆ‘è¿˜æ˜¯ä¸»è¦è¯´è¯´2ï¼Œ3ç‚¹å§<br>é¦–å…ˆæ˜¯Masonry<br>Masonryçš„ä»£ç å†™åœ¨å“ªé‡Œï¼Ÿæ–‡æ¡£è¯´ mas_makeConstraintsä¸€ç³»åˆ—æ–¹æ³•å†™åœ¨updateConstraintsè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™ä¸ªæ–¹æ³•æ˜¯ä¼šè°ƒç”¨å¤šæ¬¡çš„ï¼Œäºæ˜¯åœ¨Snapkitçš„demoä¸­å°±ä¼šæœ‰ä¸€ä¸ªæ ‡å¿—ä½ä¿è¯å…¶åªæ‰§è¡Œä¸€æ¬¡ã€‚è€Œåœ¨Masonryçš„demoä¸­View éƒ½æ˜¯ç°åœ¨initä¸­ï¼ŒViewControlleråˆ™æ˜¯å†™åœ¨ViewDidLoadä¸­ã€‚è¿™ç‚¹æˆ‘ä¸ªäººä¹Ÿä¸æ˜¯å¾ˆç¡®å®šï¼Œä¸è¿‡æˆ‘ç°åœ¨æ˜¯ä½¿ç”¨IBä¸ºä¸»ï¼Œæˆ‘å°±ä¸éœ€è¦è€ƒè™‘å†™åœ¨å“ªé‡Œäº†âœŒï¸ã€‚</p>
<p>ç„¶åå°±æ˜¯IB<br>å¹¶ä¸æ˜¯ç”¨äº†IBå°±å¯ä»¥éšä¾¿å†™äº†ï¼Œå¥½çš„å±‚æ¬¡ç»“æ„ä¸ç®¡ä½¿ç”¨frame masonry è¿˜æ˜¯IB å†™å‡ºæ¥éƒ½æ˜¯å¥½ç»´æŠ¤çš„ï¼Œç›¸åå±‚æ¬¡æ··ä¹±æ€è·¯ä¸æ¸…æ™°å°±æ˜¯ä¸€å›¢ç³Ÿï¼Œéœ€è¦è¶³å¤Ÿç†è§£è®¾è®¡è€…çš„æ„å›¾æ‰èƒ½å†™å¥½UIã€‚</p>
<p>-setNeedsUpdateConstraints<br>-setNeedsLayout<br>-setNeedsDisplay</p>
<p>æ ¸å¿ƒæ–¹æ³•1</p>
<ul>
<li>(void)updateConstraints<br>å¦‚æœä½ éœ€è¦åœ¨buttonç‚¹å‡»ä¹‹åè°ƒæ•´constrainté‚£ä¹ˆä¸€å®šè¦ç«‹åˆ»æ›´æ”¹ï¼Œä¸ºäº†ä¿è¯åœ¨åŒä¸€ä¸ªrunloopä¸­ã€‚<br>è¿™å…¶ä¸­å¯¹åº”äº†ä¸‰ä¸ª,xxxIfNeeded,setNeedsxxx,xxxSomethingã€‚å…¶å®ifNeededæ‰ä¼šç«‹åˆ»æ‰§è¡Œï¼ŒNeedsxxxæ˜¯ä¼šæ”¶é›†ç„¶åä¸€èµ·æ‰§è¡Œï¼ˆwaits for the next update cycleï¼‰ï¼ŒxxxSomethingä¸€èˆ¬éƒ½ä¸ä¼šä¸»åŠ¨å»è°ƒç”¨ï¼Œåªæ˜¯ç”¨æ¥é‡è½½ã€‚<br>æˆ‘åœ¨æ–‡æ¡£æœ€åçœ‹åˆ°ä¸€ä¸ªimportantçš„æç¤ºï¼Œ[super updateConstraints]è¦æ”¾åœ¨æœ€å</li>
</ul>
<p>æ ¸å¿ƒæ–¹æ³•2</p>
<ul>
<li>(void)layoutSubviews;<br>èµ¶åœ¨è§†å›¾ç»˜åˆ¶å‡ºæ¥ä¹‹å‰æŠ“ç´§é‡å†™ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•</li>
</ul>
<p>æ ¸å¿ƒæ–¹æ³•3</p>
<ul>
<li>(void)drawRect:(CGRect)rect;<br>ä¸€èˆ¬ä¸éœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</li>
</ul>
<ol>
<li>åŠ¨æ€è®¡ç®—é«˜åº¦<br>åœ¨iOSä¸­æœ€å¤šçš„åœ°æ–¹å…¶å®å°±æ˜¯Cellçš„è‡ªé€‚åº”é«˜åº¦äº†ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ–¹å¼ã€‚<br>åœ¨iOS5ä»¥åçš„apiä¸­tableViewå¤šäº†ä¸€ä¸ªUITableViewAutomaticDimensionçš„å¸¸é‡ï¼Œè¿™ä¸ªå¸¸é‡æ˜¯-1ã€‚è¿™ä¸ªå¸¸é‡æ˜¯rowHeight, estimatedRowHeightç­‰ä¸€ç³»åˆ—é«˜åº¦çš„é»˜è®¤å€¼ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line">@property (nonatomic) CGFloat rowHeight;             // default is UITableViewAutomaticDimension</span><br><span class="line">@property (nonatomic) CGFloat estimatedRowHeight     // default is UITableViewAutomaticDimension, set to 0 to disable</span><br></pre></td></tr></table></figure>
<p>å½“tableview è®¡ç®—ä¸€ä¸ªcellçš„é«˜åº¦çš„æ—¶å€™ï¼Œé¦–å…ˆå›å»æ£€æµ‹æ˜¯å¦å®ç°äº†heightForRowAtIndexPathçš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨æ­¤æ–¹æ³•<br>å¦‚æœtableviewæ²¡æœ‰å®ç°heightForRowAtIndexPathçš„æ–¹æ³•ï¼Œå°±æ˜¯rowHeightçš„ä½œä¸ºé«˜åº¦ã€‚ä»¥ä¸Šä¸¤ç§æ–¹å¼å¦‚æœè¿”å›UITableViewAutomaticDimensionï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šæ ¹æ®çº¦æŸè‡ªå·±è®¡ç®—é«˜åº¦äº†ã€‚<br>estimatedRowHeightçš„è®¾ç½®è¦å°½é‡æ¥è¿‘çœŸå®çš„rowHeight, ä¸ç„¶ä¸»è¦æ˜¯ä¸ºäº†indicatorä¼šæœ‰è·³åŠ¨ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨è®¾ç½®UITableViewAutomaticDimensionçš„æ—¶å€™æˆ‘ä»¬è¯¥æ€ä¹ˆå»åšï¼Œçº¦æŸæ€ä¹ˆå†™å‘¢ï¼Ÿ<br>ç­”æ¡ˆå°±æ˜¯ï¼šç”¨çº¦æŸå»æ’‘å¼€cellï¼ï¼ï¼<br>å¦‚æœåœ¨consoleä¼šæœ‰ä¸€äº›è­¦å‘Šï¼Œå¹¶ä¸”ä½ ç¡®å®šä½ çš„çº¦æŸå†™çš„æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œä½ å¯ä»¥å°†å…¶ä¸­çš„ä¸€ä¸ªé«˜åº¦ç›¸å…³çš„çº¦æŸä¼˜å…ˆçº§è®¾ç½®æˆ999å³å¯</p>
<ol>
<li><p>å¦‚ä½•å¸ƒå±€<br>é¦–å…ˆæˆ‘ä»¬è¦ç†è§£UIView å¯ä»¥ç±»æ¯”ä¸ºå‰ç«¯çš„divï¼Œä»–ä»¬éƒ½æ˜¯è½»é‡çº§çš„è€Œä¸”æ²¡æœ‰æ˜ç¡®æ„ä¹‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨å®ƒä»¬å®¹å™¨ä½¿å¾—å±‚æ¬¡æ›´åŠ æ¸…æ™°ã€‚å¥½çš„å±‚æ¬¡ç»å¯¹æ¯”å»ºç«‹ä¸€ä¸¤ä¸ªUIViewè¦æ¥çš„åˆ’ç®—ï¼Œä¸è¿‡æœ€è¦å‘½çš„è¿˜æ˜¯å‘½åã€‚ã€‚</p>
</li>
<li><p>å…³äºåŠ¨æ€ç”Ÿæˆ<br>è¿™é‡Œè¯´çš„æ˜¯åœ¨TableViewCellä¸­ï¼Œå¦‚æœæœ‰çš„å†…å®¹æ—¶æœ‰æ—¶æ— ï¼Œå¹¶ä¸èƒ½é€šè¿‡ç®€å•æ˜¾ç¤ºéšè—æ¥è§£å†³çš„è¯ï¼Œé‚£å°±ç›´æ¥æ‹–åŠ¨ç”Ÿæˆå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚è¿™é‡Œæˆ‘ç›®å‰ä½¿ç”¨çº¯ä»£ç å†™çº¦æŸè§£å†³çš„ã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼è¯·å‘Šè¯‰æˆ‘ã€‚</p>
</li>
<li><p>å…³äºscrollViewçš„autolayoutè¿™ä¸ªåœ¨é¢è¯•çš„æ—¶å€™ä¹Ÿæ˜¯ç»å¸¸è¢«é—®åˆ°<br>é™¤äº†è®¾ç½®å¸¸è§„çš„edgesä¹‹åè¿˜éœ€è¦è®¾ç½®contentViewçš„å®½é«˜ï¼Œä½¿ç”¨è¿™ä¹ˆä¸€ä¸ªcontentViewæ¥æ’‘å¼€è¿™ä¸ªscrollView</p>
</li>
<li><p>åœ¨ä½¿ç”¨xibçš„è¿‡ç¨‹ä¸­æ˜¯å¦é‡åˆ°è¿‡åªæ˜¯æ·»åŠ ä¸€ä¸ªå ä½çš„UIViewã€‚<br>ä½†æ˜¯ä¸è®¾ç½®å®½é«˜ä¼šæœ‰çº¢çº¢çš„è­¦å‘Šï¼Œè®¾ç½®äº†å®½é«˜çš„è¯åˆä¼šæœ‰é—®é¢˜ï¼ˆå› ä¸ºæ¯•ç«Ÿä¸æ˜¯çœŸå®éœ€è¦çš„å®½é«˜ï¼ŒçœŸå®éœ€è¦çš„æ˜¯æ ¹æ®æ•°æ®ç”Ÿæˆçš„ï¼‰ã€‚è¿™æ˜¯xibçš„çº¦æŸæœ‰ä¸ªPlaceholder remove at build timeçš„è®¾ç½®å¯ä»¥å‹¾ä¸Šï¼Œå®Œç¾ï¼</p>
</li>
<li><p>åœ¨ä½¿ç”¨UILabelçš„è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨ä¸¤ä¸ªUILabelï¼Œå½“æ–‡å­—è¶…é•¿çš„æ—¶å€™æŒ¤å‹å“ªä¸€ä¸ªï¼Ÿå½“æ–‡å­—éƒ½çŸ­çš„æ—¶å€™æ‹‰ä¼¸å“ªä¸€ä¸ªï¼Ÿ</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)setContentHuggingPriority:(UILayoutPriority)priority forAxis:(UILayoutConstraintAxis)axis;</span><br><span class="line">- (void)setContentCompressionResistancePriority:(UILayoutPriority)priority forAxis:(UILayoutConstraintAxis)axis;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºUILabelæ¥è¯´HuggingPriorityé»˜è®¤æ˜¯251è¢«æ‹‰ä¼¸çš„éš¾æ˜“åº¦ï¼ŒCompressionResistancePriorityé»˜è®¤æ˜¯750è¢«å‹ç¼©çš„éš¾æ˜“åº¦ï¼Œæ•°å€¼è¶Šå¤§ä»£è¡¨è¶Šç¨³å®šè¶Šä¸å®¹æ˜“å˜åŒ–ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/11/Autolayoutå­¦ä¹ ç¬”è®°/" data-id="ckbnff0ww0001lwj7532war4s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CoreAnimationå­¦ä¹ ç¬”è®°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/28/CoreAnimationå­¦ä¹ ç¬”è®°/" class="article-date">
  <time datetime="2018-02-28T01:15:51.000Z" itemprop="datePublished">2018-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/28/CoreAnimationå­¦ä¹ ç¬”è®°/">CoreAnimationå­¦ä¹ ç¬”è®°</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>åˆšåˆšåŠ å…¥åˆ°ä¸€ä¸ªæ–°çš„å›¢é˜Ÿï¼Œæ¥åˆ°çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ä¾¿æ˜¯ä¸€ä¸ªåŠ¨ç”»çš„éœ€æ±‚ï¼Œè‡ªç„¶ä¸èƒ½æ€ æ…¢ã€‚ä¹‹å‰çš„å·¥ä½œä¸­å¯¹iOSçš„åŠ¨ç”»æŒæ¡ä»…ä»…é™äºUIViewçš„BlockåŠ¨ç”»ï¼Œå®åœ¨æ˜¯æƒ­æ„§ï¼Œä¸å¦‚å°±è¿™ä¸ªæœºä¼šå¥½å¥½ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªCoreAnimation,äºæ˜¯æ‰æœ‰è¿™ä¸ªç¬”è®°ã€‚æœç´¢äº†ä¸€ä¸‹èµ„æºï¼Œå¥½è¯„è¾ƒé«˜çš„æ˜¯è¿™ä¸ªgithubçš„å¼€æºä¹¦ç±<a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques" target="_blank" rel="noopener">iOS-Core-Animation-Advanced-Techniques</a>ã€‚</p>
<p>é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ã€‚CoreAnimationå¹¶ä¸ä»…ä»…æ˜¯åŠ¨ç”»ï¼ŒWhat? æˆ‘è¿™ä¹ˆå¤šå¹´çš„è‹±è¯­ç™½å­¦äº†ä¹ˆï¼Œä¸”å¾€ä¸‹çœ‹ã€‚</p>
<h2 id="UIViewå’ŒCALayer"><a href="#UIViewå’ŒCALayer" class="headerlink" title="UIViewå’ŒCALayer"></a>UIViewå’ŒCALayer</h2><p>UIViewå†ç†Ÿæ‚‰ä¸è¿‡å•¦ï¼ŒCALayerä¹Ÿè®¸æ²¡é‚£ä¹ˆç†Ÿï¼Œä½†æ˜¯cornerRadius,borderWidth,borderColorç­‰å±æ€§ç›¸æ¯”æ²¡æœ‰å°‘ç”¨å§ã€‚çœ‹åˆ°CALayerè¿™ä¸ªåå­—ï¼Œä½ åº”è¯¥ä¼šæƒ³åˆ°ç‚¹ä»€ä¹ˆå¯¹å§ï¼Œæ²¡é”™å‰ç¼€CAå°±æ˜¯CoreAnimationçš„æ„æ€ã€‚é‚£ä¹ˆä¸‹é¢æ˜¯ä¸€é“é¢è¯•é¢˜ï¼Œè®²è®²å®ƒä»¬çš„å…³ç³»ã€‚æ¯ä¸€ä¸ªUIViewéƒ½æœ‰ä¸€ä¸ªlayerå±æ€§ï¼Œè¿™æ‰æ˜¯ä»–æ˜¾ç¤ºçš„åŸå› ï¼ŒCALayerå¹¶ä¸çŸ¥é“å“åº”é“¾çš„å­˜åœ¨ï¼Œè€Œä¸”ç¼ºä¹Autolayoutçš„æ”¯æŒã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆè¦åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä»£ç çš„å¤ç”¨ï¼Œå› ä¸ºMacOSçš„æ˜¾ç¤ºä¹Ÿæ˜¯CALayer, ä½†æ˜¯é¼ æ ‡ã€é”®ç›˜çš„å“åº”å¤„ç†ï¼Œå´æ˜¯æˆªç„¶ä¸åŒçš„é€»è¾‘ã€‚UIViewå¯¹CALayerè¿›è¡Œäº†ç®€å•çš„å°è£…ï¼ŒåŒ…å«äº†å¤§éƒ¨åˆ†åŸºç¡€çš„å±æ€§ã€‚frame bounds center clipToBounds ==&gt; frame bounds position maskToBoundsç­‰ç­‰ï¼Œä½†ä¹Ÿä¸æ˜¯å…¨éƒ¨ï¼Œæ¯”å¦‚cornerRadius,shadowPathï¼Œè¿˜æœ‰ä¸€äº›åˆ«çš„æ²¡æœ‰æš´éœ²å‡ºæ¥ã€‚å­¦ä¹ CALayeræ˜¯æœ‰å¿…è¦çš„ã€‚ä¸€å®šç¨‹åº¦ä¸Šæ¥è¯´CALayeræ›´è½»é‡çº§ï¼Œæ€§èƒ½ä¼šæœ‰æé«˜ã€‚ï¼ˆä½†æ˜¯ç»å¤§éƒ¨åˆ†è¿˜æ˜¯UIViewæ›´åˆé€‚ï¼Œè‡³å°‘AutoLayoutå°±å·²ç»è®©äººæ— æ³•æ‹’ç»äº†ï¼‰</p>
<h2 id="CALayerçš„å±æ€§ç®€å•è®²è§£"><a href="#CALayerçš„å±æ€§ç®€å•è®²è§£" class="headerlink" title="CALayerçš„å±æ€§ç®€å•è®²è§£"></a>CALayerçš„å±æ€§ç®€å•è®²è§£</h2><ol>
<li>contents         idç±»å‹ï¼Œä½†æ˜¯åªåœ¨iOSä¸Šåªæœ‰ä¼ å…¥ä¸€ä¸ªCGImageRefç±»å‹çš„å›¾ç‰‡æ‰ä¼šæœ‰æ˜¾ç¤º</li>
<li>contentGravity   å¯¹åº”å›¾ç‰‡çš„æ˜¾ç¤ºæ¨¡å¼ï¼Œæœ‰ç‚¹å¯¹åº”UIViewçš„ContentMode</li>
<li>contentsScale    å®šä¹‰äº†å¯„å®¿å›¾çš„åƒç´ å°ºå¯¸å’Œè§†å›¾å¤§å°çš„æ¯”ä¾‹</li>
<li>maskToBounds     å¯¹åº”äºUIViewçš„ClipToBounds</li>
<li>contentsRect     ä¸€èˆ¬ç”¨äºæ˜¾ç¤ºç²¾çµå›¾</li>
<li><p>contentsCenter   è§„å®šæ‹‰ä¼¸åŒºåŸŸ</p>
</li>
<li><p>frame            å¤–éƒ¨åæ ‡, æ˜¯ç”±bounds,position,transformè®¡ç®—è€Œæ¥çš„</p>
</li>
<li>bounds           å†…éƒ¨åæ ‡</li>
<li>position         é”šç‚¹ç›¸å¯¹äºçˆ¶layerä½ç½®</li>
<li>transform</li>
<li>anchorPoint     é»˜è®¤ä½äºlayerçš„ä¸­å¿ƒ{0.5, 0.5}ï¼Œç›¸å¯¹åæ ‡ï¼Œå¯æ”¹å˜</li>
<li>zPosition       floatæ§åˆ¶ä¸Šä¸‹é¡ºåº</li>
</ol>
<p>è™½ç„¶CALayerä¸èƒ½å¤„ç†äº‹ä»¶ï¼Œä½†æ˜¯å´æä¾›äº†ä¸¤ä¸ªå¸®åŠ©å¤„ç†çš„æ–¹æ³•</p>
<ol>
<li>containsPoint</li>
<li><p>hitTest    </p>
</li>
<li><p>cornerRadius</p>
</li>
<li>borderWidth</li>
<li>borderColor</li>
<li>shadowColor,shadowOffset,shadowRadius</li>
<li>shadowPath</li>
<li>mask            maskä¸é€æ˜çš„åœ°æ–¹å°±æ˜¯ä¿ç•™ä¸‹æ¥çš„å€¼</li>
<li>opacity         å¯¹åº”UIViewçš„Alpha</li>
<li>shouldRasterize æ …æ ¼åŒ–</li>
</ol>
<h2 id="ä¸“æœ‰å›¾å±‚"><a href="#ä¸“æœ‰å›¾å±‚" class="headerlink" title="ä¸“æœ‰å›¾å±‚"></a>ä¸“æœ‰å›¾å±‚</h2><ol>
<li>CAShapeLayer</li>
<li>CATextLayer</li>
<li>CATransformLayer</li>
<li>CAGradientLayer</li>
<li>CAReplicatorLayer</li>
<li>CAScrollLayer</li>
<li>CATiledLayer</li>
<li>CAEmitterLayer</li>
<li>CAEAGLLayer</li>
<li>AVPlayerLayer</li>
</ol>
<h2 id="éšå¼åŠ¨ç”»"><a href="#éšå¼åŠ¨ç”»" class="headerlink" title="éšå¼åŠ¨ç”»"></a>éšå¼åŠ¨ç”»</h2><p>æ”¹å˜CALayerä¸€ä¸ªå¯åšåŠ¨ç”»çš„å±æ€§æ—¶ï¼Œå±æ€§ä¼šä»å…ˆå‰çš„å€¼å¹³æ»‘è¿‡æ¸¡åˆ°æ–°çš„å€¼ï¼Œè¿™ä¸€åˆ‡éƒ½ä¼šé»˜è®¤è¡Œä¸ºã€‚<br>CoreAnimationåœ¨æ¯ä¸ªrunloopè‡ªåŠ¨å¼€å§‹ä¸€æ¬¡æ–°çš„äº‹åŠ¡CATransactionã€‚</p>
<p>CATransactioné€šè¿‡å…¥æ ˆå‡ºæ ˆçš„æ–¹å¼å·¥ä½œï¼Œå¯ä»¥è®¾ç½®æ—¶é—´å’Œå®Œæˆåçš„ä»»åŠ¡ã€‚<br>begin<br>setAnimationDuration<br>setCompletionBlock<br>commit</p>
<p>éšèº«åŠ¨ç”»ä¸èƒ½å¯¹UIViewçš„å…³è”å›¾å±‚èµ·ä½œç”¨ï¼Œé‚£æ˜¯å¦‚ä½•ç¦ç”¨çš„å‘¢ï¼Ÿ<br>-actionForKey: ä¸»è¦æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä»¥åŠå†…éƒ¨çš„ä¸€ç³»åˆ—æ–¹æ³•ã€‚è¿”å›nil,åˆ™æ²¡æœ‰åŠ¨ç”»ï¼Œè¿”å›CAActionåè®®å¯¹è±¡ï¼ŒCALayerå»åšåŠ¨ç”»ã€‚<br>æ‰€ä»¥UIViewå…¶å®å°±æ˜¯layerçš„Delegate, å¹¶ä¸”æä¾›äº†-actionForLayer:forKeyçš„å®ç°æ–¹æ³•ã€‚å½“ä¸åœ¨ä¸€ä¸ªåŠ¨ç”»å—çš„å®ç°ä¸­ï¼ŒUIViewå¯¹æ‰€æœ‰å›¾å±‚è¡Œä¸ºè¿”å›nilï¼Œä½†æ˜¯åœ¨åŠ¨ç”»blockèŒƒå›´ä¹‹å†…ï¼Œå®ƒå°±è¿”å›äº†ä¸€ä¸ªéç©ºå€¼ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥é€šè¿‡setDisableActionsï¼Œç¦ç”¨éšå¼åŠ¨ç”»ã€‚</p>
<p>å½“è®¾ç½®å±æ€§çš„æ—¶å€™æ”¹å˜çš„æ˜¯æ¨¡å‹å›¾å±‚ï¼ŒåŠ¨ç”»ä¸­çœ‹åˆ°çš„æ˜¯å‘ˆç°å›¾å±‚ã€‚<br>presentationLayer<br>modelLayer</p>
<h2 id="æ˜¾å¼åŠ¨ç”»"><a href="#æ˜¾å¼åŠ¨ç”»" class="headerlink" title="æ˜¾å¼åŠ¨ç”»"></a>æ˜¾å¼åŠ¨ç”»</h2><p>èƒ½å¤Ÿå¯¹ä¸€äº›å±æ€§åšæŒ‡å®šçš„è‡ªå®šä¹‰åŠ¨ç”»ï¼Œæˆ–è€…åˆ›å»ºéçº¿æ€§åŠ¨ç”»ï¼Œæ¯”å¦‚æ²¿ç€ä»»æ„ä¸€æ¡æ›²çº¿ç§»åŠ¨ã€‚</p>
<h3 id="å±æ€§åŠ¨ç”»"><a href="#å±æ€§åŠ¨ç”»" class="headerlink" title="å±æ€§åŠ¨ç”»"></a>å±æ€§åŠ¨ç”»</h3><p>CAAnimation â€“&gt; CAPropertyAnimation â€“&gt; CABasicAnimation</p>
<p>id fromValue<br>id toValue<br>id byValue</p>
<p>åŠ¨ç”»å¾ˆå¸¸è§çš„é—®é¢˜æ˜¯ï¼ŒåŠ¨ç”»ç»“æŸä¹‹ååˆç«‹åˆ»å˜å›åŸå§‹å€¼ã€‚è¿™æ˜¯å› ä¸ºåŠ¨ç”»å¹¶æ²¡æœ‰æ”¹å˜å›¾å±‚æ¨¡å‹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨åŠ¨ç”»å¼€å§‹ä¹‹å‰æˆ–è€…ä¹‹åæ”¹å˜å±æ€§çš„å€¼ã€‚</p>
<p>åŠ¨ç”»ä¹‹å‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)applyBasicAnimation:(CABasicAnimation *)animation toLayer:(CALayer *)layer</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //set the from value (using presentation layer if available)</span><br><span class="line">    animation.fromValue = [(layer.presentationLayer ? layer.presentationLayer : layer) valueForKeyPath:animation.keyPath];</span><br><span class="line">    //update the property in advance</span><br><span class="line">    //note: this approach will only work if toValue != nil </span><br><span class="line">    [CATransaction begin];</span><br><span class="line">    [CATransaction setDisableActions:YES];</span><br><span class="line">    [layer setValue:animation.toValue forKeyPath:animation.keyPath];</span><br><span class="line">    [CATransaction commit];</span><br><span class="line">    //apply animation to layer</span><br><span class="line">    [layer addAnimation:animation forKey:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŠ¨ç”»ä¹‹åï¼š</p>
<p>-animationDidStop:finished:</p>
<p>CAAnimationå®ç°äº†KVCï¼ˆé”®-å€¼-ç¼–ç ï¼‰åè®®ï¼Œäºæ˜¯ä½ å¯ä»¥ç”¨-setValue:forKey:å’Œ-valueForKey:æ–¹æ³•æ¥å­˜å–å±æ€§ã€‚ä½†æ˜¯CAAnimationæœ‰ä¸€ä¸ªä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼šå®ƒæ›´åƒä¸€ä¸ªNSDictionaryï¼Œå¯ä»¥è®©ä½ éšæ„è®¾ç½®é”®å€¼å¯¹ï¼Œå³ä½¿å’Œä½ ä½¿ç”¨çš„åŠ¨ç”»ç±»æ‰€å£°æ˜çš„å±æ€§å¹¶ä¸åŒ¹é…ã€‚</p>
<h3 id="å…³é”®å¸§åŠ¨ç”»"><a href="#å…³é”®å¸§åŠ¨ç”»" class="headerlink" title="å…³é”®å¸§åŠ¨ç”»"></a>å…³é”®å¸§åŠ¨ç”»</h3><p>CAAnimation â€“&gt; CAPropertyAnimation â€“&gt; CAKeyframeAnimation</p>
<p>values<br>path</p>
<h3 id="åŠ¨ç”»ç»„"><a href="#åŠ¨ç”»ç»„" class="headerlink" title="åŠ¨ç”»ç»„"></a>åŠ¨ç”»ç»„</h3><p>CAAnimationGroup</p>
<h2 id="è¿‡æ¸¡åŠ¨ç”»"><a href="#è¿‡æ¸¡åŠ¨ç”»" class="headerlink" title="è¿‡æ¸¡åŠ¨ç”»"></a>è¿‡æ¸¡åŠ¨ç”»</h2><p>CATransition</p>
<h2 id="åŠ¨ç”»çš„æ—¶é—´"><a href="#åŠ¨ç”»çš„æ—¶é—´" class="headerlink" title="åŠ¨ç”»çš„æ—¶é—´"></a>åŠ¨ç”»çš„æ—¶é—´</h2><p>duration é»˜è®¤0.25<br>repeatCount é»˜è®¤1<br>repeatDuration å®ƒè®©åŠ¨ç”»é‡å¤ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ï¼Œè€Œä¸æ˜¯æŒ‡å®šæ¬¡æ•°ã€‚<br>autoreverses</p>
<p>beginTime<br>speed<br>timeOffset</p>
<p>fillMode</p>
<h2 id="ç¼“å†²æ–¹ç¨‹å¼"><a href="#ç¼“å†²æ–¹ç¨‹å¼" class="headerlink" title="ç¼“å†²æ–¹ç¨‹å¼"></a>ç¼“å†²æ–¹ç¨‹å¼</h2><p>CAMediaTimingFunction timingFunctionWithName:   +functionWithControlPoints::::<br>timingFunctions ä¸€ä¸ªæ•°ç»„</p>
<p>å½“ä¸€ä¸ªå¤æ‚çš„ç¼“å†²å‡ºç°çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ä½¿ç”¨ä¸€ä¸ª3æ¬¡è´å¡å°”æ›²çº¿æè¿°ï¼Œå¯ä»¥ä½¿ç”¨</p>
<ol>
<li>ç”¨CAKeyframeAnimationåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ï¼Œç„¶ååˆ†å‰²æˆå‡ ä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªå°æ­¥éª¤ä½¿ç”¨è‡ªå·±çš„è®¡æ—¶å‡½æ•°</li>
<li>ä½¿ç”¨å®šæ—¶å™¨é€å¸§æ›´æ–°å®ç°åŠ¨ç”»</li>
</ol>
<h2 id="CADisplayLink-NSTimer-NSRunloop"><a href="#CADisplayLink-NSTimer-NSRunloop" class="headerlink" title="CADisplayLink NSTimer NSRunloop"></a>CADisplayLink NSTimer NSRunloop</h2><h2 id="æ€§èƒ½è°ƒä¼˜ï¼ŒCPUã€GPU-é«˜æ•ˆç»˜å›¾ï¼Œå›¾åƒIO-å›¾å±‚æ€§èƒ½"><a href="#æ€§èƒ½è°ƒä¼˜ï¼ŒCPUã€GPU-é«˜æ•ˆç»˜å›¾ï¼Œå›¾åƒIO-å›¾å±‚æ€§èƒ½" class="headerlink" title="æ€§èƒ½è°ƒä¼˜ï¼ŒCPUã€GPU, é«˜æ•ˆç»˜å›¾ï¼Œå›¾åƒIO,å›¾å±‚æ€§èƒ½"></a>æ€§èƒ½è°ƒä¼˜ï¼ŒCPUã€GPU, é«˜æ•ˆç»˜å›¾ï¼Œå›¾åƒIO,å›¾å±‚æ€§èƒ½</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/28/CoreAnimationå­¦ä¹ ç¬”è®°/" data-id="ckbnff0x20003lwj7xcs5chpr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-AFNetworkingå­¦ä¹ ç¬”è®°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/27/AFNetworkingå­¦ä¹ ç¬”è®°/" class="article-date">
  <time datetime="2018-02-27T01:17:31.000Z" itemprop="datePublished">2018-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/27/AFNetworkingå­¦ä¹ ç¬”è®°/">AFNetworkingå­¦ä¹ ç¬”è®°</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœ¬æ–‡æ˜¯åŸºäº<a href="https://github.com/AFNetworking/AFNetworking/tree/3.2.0" target="_blank" rel="noopener">AFNetworking</a>v3.2.0</p>
<p>AFNetworking3.0ä»¥åå»é™¤äº†å…³äºNSURLConnectçš„å†…å®¹ï¼Œéƒ½æ˜¯åŸºäºNSURLSessionå»å®ç°çš„ï¼Œæä¾›äº†AFURLSessionManagerå’ŒAFHTTPSessionManagerä¸¤ä¸ªå¤–éƒ¨ä½¿ç”¨çš„Managerã€‚æä¾›äº†AFURLRequestSerializationå’ŒAFURLResponseSerializationï¼Œè¯·æ±‚åºåˆ—åŒ–å’Œå“åº”åºåˆ—åŒ–çš„ç±»ã€‚å¦å¤–è¿˜æœ‰AFSecurityPolicyå’ŒAFNetworkReachabilityManagerç½‘ç»œçŠ¶æ€ã€‚</p>
<h2 id="AFHTTPSessionManager"><a href="#AFHTTPSessionManager" class="headerlink" title="AFHTTPSessionManager"></a>AFHTTPSessionManager</h2><p>é¦–å…ˆä»ç¦»æˆ‘ä»¬æœ€è¿‘çš„è¿™ä¸ªèŠèµ·å§ã€‚å®ƒç»§æ‰¿è‡ªAFURLSessionManagerã€‚å¹¶ä¸”å®ç°äº†ä¸¤ä¸ªåè®®&lt;NSSecureCoding, NSCopying&gt;ã€‚</p>
<h3 id="å››ä¸ªå±æ€§"><a href="#å››ä¸ªå±æ€§" class="headerlink" title="å››ä¸ªå±æ€§"></a>å››ä¸ªå±æ€§</h3><p>baseURL<br>requestSerializer<br>responseSerializer<br>securityPolicy</p>
<p>baseURLæœ¬èº«æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„<br>ä½†æ˜¯æ³¨æ„åˆ°ä¸ºä»€ä¹ˆåœ¨hæ–‡ä»¶ä¸­<br>@property (readonly, nonatomic, strong, nullable) NSURL <em>baseURL;<br>åœ¨mæ–‡ä»¶ä¸­å´åˆå†å†™ä¸€æ¬¡å‘¢ï¼Œå±…ç„¶ä¸æŠ¥é”™ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå†™å‘¢ï¼Œä»ä¿®é¥°å…³é”®å­—å¯ä»¥çœ‹å‡ºï¼Œæ˜¯ä¸ºäº†å¯¹å¤–åªè¯»ï¼Œå¯¹å†…è¯»å†™ã€‚æ€ä¹ˆè¯´å‘¢ï¼Œæ„Ÿè§‰æ¯”åœ¨å¾ˆä¸­é—´ç›´æ¥å†™ä¸€ä¸ªgetæ–¹æ³•ä¼˜é›…ä¸€äº›ï¼Œæ¯•ç«ŸåŒ…å«æ›´å¤šçš„ä¿¡æ¯é‡ã€‚<br>@property (readwrite, nonatomic, strong) NSURL </em>baseURL;</p>
<p>requestSerializer é»˜è®¤ä¸ºAFHTTPRequestSerializer</p>
<p>responseSerializer é»˜è®¤ä¸ºAFJSONResponseSerializer </p>
<p>@dynamic responseSerializer;<br>@dynamic securityPolicy;<br>è¿™é‡Œç¨å¾®æ³¨æ„ä¸€ä¸‹@dynamicå…³é”®å­— å‚æ•°responseSerializerçš„getterå’Œsetteræ–¹æ³•å¹¶ä¸åœ¨æ­¤å¤„ï¼Œè€Œåœ¨å…¶ä»–åœ°æ–¹å®ç°äº†æˆ–è€…ç”Ÿæˆäº†ï¼Œå½“ä½ ç¨‹åºè¿è¡Œçš„æ—¶å€™ä½ å°±çŸ¥é“äº†ï¼Œæ‰€ä»¥åˆ«è­¦å‘Šæˆ‘äº†</p>
<h3 id="ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•"><a href="#ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•"></a>ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)manager;</span><br><span class="line">- (instancetype)initWithBaseURL:(nullable NSURL *)url;</span><br><span class="line">- (instancetype)initWithBaseURL:(nullable NSURL *)url sessionConfiguration:(nullable NSURLSessionConfiguration *)configuration NS_DESIGNATED_INITIALIZER;</span><br></pre></td></tr></table></figure>
<p>å‰å‡ ä¸ªæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½æ˜¯è°ƒç”¨äº†æœ€åä¸€ä¸ªNS_DESIGNATED_INITIALIZERï¼Œå…³äºdesignated_initializeråœ¨OCä¸­ä¸å¤ªå¸¸è§ï¼Œåœ¨Swiftçš„æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæˆ‘æˆªå–ä¸€éƒ¨åˆ†</p>
<blockquote>
<p>Designated initializers are the primary initializers for a class. A designated initializer fully initializes all properties introduced by that class and calls an appropriate superclass initializer to continue the initialization process up the superclass chain.</p>
<p>Classes tend to have very few designated initializers, and it is quite common for a class to have only one. Designated initializers are â€œfunnelâ€ points through which initialization takes place, and through which the initialization process continues up the superclass chain.</p>
<p>Every class must have at least one designated initializer. In some cases, this requirement is satisfied by inheriting one or more designated initializers from a superclass, as described in Automatic Initializer Inheritance below.</p>
<p>Convenience initializers are secondary, supporting initializers for a class. You can define a convenience initializer to call a designated initializer from the same class as the convenience initializer with some of the designated initializerâ€™s parameters set to default values. You can also define a convenience initializer to create an instance of that class for a specific use case or input value type.</p>
<p>You do not have to provide convenience initializers if your class does not require them. Create convenience initializers whenever a shortcut to a common initialization pattern will save time or make initialization of the class clearer in intent.</p>
</blockquote>
<p>å¤§æ„å°±æ˜¯æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ˜¯ä¸€ä¸ªç±»çš„é¦–è¦åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¯ä¸ªç±»è‡³å°‘æœ‰ä¸€ä¸ªæ­£å¸¸è¯·æ±‚ä¹Ÿåªæœ‰ä¸€ä¸ªï¼Œä¸ä¹‹å¯¹åº”çš„ä¾¿åˆ©åˆå§‹åŒ–æ–¹æ³•æ˜¯æ¬¡è¦åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•éœ€è¦åˆå§‹åŒ–ç±»æ‰€æœ‰å±æ€§ï¼Œå¹¶è°ƒç”¨ä¸€ä¸ªåˆç†çš„çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•å»å®Œæˆç»§æ‰¿é“¾ä¸Šçš„åˆå§‹åŒ–ä»»åŠ¡ã€‚ä¾¿åˆ©åˆå§‹åŒ–æ–¹æ³•å¯ä»¥è°ƒç”¨ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶æŠŠä¸€äº›æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•çš„å‚æ•°è®¾ç½®ä¸ºé»˜è®¤ã€‚å®ƒæ˜¯åˆ›å»ºå®ä¾‹çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œä½¿å¾—åˆå§‹åŒ–æ„å›¾æ›´æ¸…æ™°ã€‚</p>
<h3 id="ä¸€å †HTTPçš„æ–¹æ³•"><a href="#ä¸€å †HTTPçš„æ–¹æ³•" class="headerlink" title="ä¸€å †HTTPçš„æ–¹æ³•"></a>ä¸€å †HTTPçš„æ–¹æ³•</h3><p>GET, HEAD, POST, PUT, PATCH, DELETEæ–¹æ³•<br>è¿™é‡Œé™¤äº†æ­£ç¡®çš„ä½¿ç”¨å¯¹åº”çš„httpæ–¹æ³•ä¹‹å¤–ã€‚æœ‰ä¸€ä¸ªtipï¼Œæ–¹æ³•éƒ½è¿”å›äº†ä¸€ä¸ªNSURLSessionDataTaskå¯¹è±¡ã€‚æˆ‘è§‰å¾—è¿™ä¸ªå¯¹è±¡çš„ä¸»è¦ä½œç”¨åœ¨äºç®¡ç†å·²å‘å‡ºçš„è¯·æ±‚ï¼Œæ›´å…·ä½“ä¸€ç‚¹ï¼Œæ¯”å¦‚æˆ‘åœ¨è¿ç»­å‘é€è¯·æ±‚çš„æ—¶å€™å¯ä»¥å–æ¶ˆä¸Šä¸€æ¬¡çš„è¯·æ±‚ï¼Œåªå‘é€æœ¬æ¬¡è¯·æ±‚ã€‚å¦‚ä½•å–æ¶ˆå‘¢ï¼Ÿå°±æ˜¯taskçš„cancelæ–¹æ³•äº†ã€‚</p>
<p>è¿™äº›æ–¹æ³•ä¸­ç»å¤§éƒ¨åˆ†æœ€ç»ˆéƒ½è°ƒç”¨äº†dataTaskWithHTTPMethodæ–¹æ³•ã€‚<br>æ­¤æ–¹æ³•å…ˆæ˜¯ä½¿ç”¨requestSerializerï¼Œåˆ›å»ºå‡ºä¸€ä¸ªNSMutableURLRequestå¯¹è±¡<br>é€šè¿‡dataTaskWithRequeståˆ›å»ºdataTaskå¯¹è±¡ï¼Œå…¶ä¸­__block ä¿®é¥°çš„dataTaskå¯¹è±¡<br>è°ƒç”¨resumeæ–¹æ³•</p>
<h2 id="AFURLSessionManager"><a href="#AFURLSessionManager" class="headerlink" title="AFURLSessionManager"></a>AFURLSessionManager</h2><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>session è¢«ç®¡ç†çš„NSURLSessionå¯¹è±¡<br>operationQueue Sessionå‘é€è¯·æ±‚æ‰€åœ¨çš„é˜Ÿåˆ—<br>securityPolicy å®‰å…¨ç­–ç•¥<br>reachabilityManager ç½‘ç»œç›‘æ§å™¨<br>responseSerializer å“åº”åºåˆ—åŒ–å™¨</p>
<p>tasks<br>dataTasks<br>uploadTasks<br>downloadTasks<br>è¿™å››ä¸ªä¸ºè®¡ç®—å±æ€§ï¼Œæœ¬èº«æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½†æ˜¯çœ‹æºç çœ‹åˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚è¿™æ˜¯GCDä¸­ä¿¡å·é‡çš„ä½¿ç”¨ã€‚<br>dispatch_semaphore_create åˆ›å»ºä¸€ä¸ªä¿¡å·è®¡æ•°ã€‚<br>dispatch_semaphore_signal å‘å‡ºä¸€ä¸ªä¿¡å·ä½¿å¾—è®¡æ•°+1ã€‚<br>dispatch_semaphore_wait å½“ä¿¡å·æ€»é‡å°‘äº0çš„æ—¶å€™å°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¦åˆ™å°±å¯ä»¥æ­£å¸¸çš„æ‰§è¡Œï¼Œå¹¶è®©ä¿¡å·æ€»é‡-1ã€‚<br>ä¸‹é¢çš„ä»£ç ç»„åˆä¾¿å¯ä»¥ç­‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆå†æ‰§è¡Œä¹‹åä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</span><br><span class="line">dispatch_semaphore_signal(semaphore);</span><br><span class="line">dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br></pre></td></tr></table></figure>
<p>completionQueue å®Œæˆé˜Ÿåˆ—ï¼Œé»˜è®¤ä¸ºä¸»é˜Ÿåˆ—ã€‚<br>completionGroup ä½¿ç”¨dispatch_group_asyncç”¨æ¥å¼‚æ­¥æ´¾å‘æ‰§è¡ŒcompletionHandlerå›è°ƒæ˜¯ä¸ºäº†<br>ç•™ç»™è°ƒç”¨è€…ä½¿ç”¨dispatch_group_notifyç­‰å‡½æ•°æœ‰æœºä¼šç›‘å¬completionHandleræ‰§è¡Œå®Œæˆåçš„å›è°ƒ</p>
<p>attemptsToRecreateUploadTasksForBackgroundSessions, å¦‚æœåˆ›å»ºuploadTaskå¤±è´¥å°±é‡è¯•3æ¬¡</p>
<h3 id="åˆå§‹åŒ–æ–¹æ³•"><a href="#åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="åˆå§‹åŒ–æ–¹æ³•"></a>åˆå§‹åŒ–æ–¹æ³•</h3><ul>
<li>(instancetype)initWithSessionConfiguration:(nullable NSURLSessionConfiguration *)configuration NS_DESIGNATED_INITIALIZER;</li>
</ul>
<p>åˆå§‹åŒ– configurationï¼ŒoperationQueue, session, responseSerializerç­‰ä¸€å †</p>
<p>å…¶å®æ¯ä¸€ä¸ªtaskå¯¹åº”ä¸€ä¸ªAFURLSessionManagerTaskDelegateï¼Œç”¨taskçš„identifierä½œä¸ºkey,å°†å…¶å­˜åœ¨ä¸€ä¸ªNSMutableDictionaryä¸­ã€‚åœ¨è¿™ä¸ªDelegateä¸­å¤„ç†å„è‡ªçš„è¯·æ±‚</p>
<h3 id="ä¸»è¦æ˜¯å‘é€è¯·æ±‚çš„ä¸€å †æ–¹æ³•"><a href="#ä¸»è¦æ˜¯å‘é€è¯·æ±‚çš„ä¸€å †æ–¹æ³•" class="headerlink" title="ä¸»è¦æ˜¯å‘é€è¯·æ±‚çš„ä¸€å †æ–¹æ³•"></a>ä¸»è¦æ˜¯å‘é€è¯·æ±‚çš„ä¸€å †æ–¹æ³•</h3><p>dataTaskWithRequest<br>upload<br>download</p>
<p>è®¾ç½®å„ç§blockçš„</p>
<h2 id="AFSecurityPolicy"><a href="#AFSecurityPolicy" class="headerlink" title="AFSecurityPolicy"></a>AFSecurityPolicy</h2><p>ç”¨äºéªŒè¯HTTPSè¯·æ±‚çš„è¯ä¹¦ï¼ŒCAæœºæ„é¢å‘è¯ä¹¦æ¯”è¾ƒæ˜‚è´µï¼ŒSSLPinningModeä¸ºè¯ä¹¦ç»‘å®šï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯ç›´æ¥ä¿å­˜æœåŠ¡ç«¯çš„è¯ä¹¦ï¼Œå»ºç«‹httpsè¿æ¥æ—¶ç›´æ¥å¯¹æ¯”æœåŠ¡ç«¯è¿”å›çš„å’Œå®¢æˆ·ç«¯ä¿å­˜çš„ä¸¤ä¸ªè¯ä¹¦æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·å°±è¡¨æ˜è¯ä¹¦æ˜¯çœŸçš„ï¼Œä¸å†å»ç³»ç»Ÿçš„ä¿¡ä»»è¯ä¹¦æœºæ„é‡Œå¯»æ‰¾éªŒè¯ã€‚</p>
<p><strong>å…¬é’¥ç§é’¥åŠ å¯†ï¼Œå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼Œç§é’¥ç­¾åå…¬é’¥éªŒè¯ã€‚</strong></p>
<h3 id="å››ä¸ªå±æ€§-1"><a href="#å››ä¸ªå±æ€§-1" class="headerlink" title="å››ä¸ªå±æ€§"></a>å››ä¸ªå±æ€§</h3><p>SSLPinningModeï¼ŒAFSSLPinningModeNoneåªåœ¨ç³»ç»Ÿä¿¡ä»»æœºæ„åˆ—è¡¨é‡ŒéªŒè¯æœåŠ¡ç«¯è¿”å›çš„è¯ä¹¦ã€‚AFSSLPinningModeCertificateéªŒè¯åŸŸåæœ‰æ•ˆæœŸï¼Œåœ¨éªŒè¯å…¬é’¥ã€‚AFSSLPinningModePublicKeyéªŒè¯å…¬é’¥ã€‚<br>pinnedCertificates é™„å±çš„è¯ä¹¦<br>allowInvalidCertificates å…è®¸éæƒå¨æœºæ„é¢å‘è¯ä¹¦çš„ é»˜è®¤NO<br>validatesDomainName éªŒè¯åŸŸå é»˜è®¤YES</p>
<h3 id="ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•-1"><a href="#ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•-1" class="headerlink" title="ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•"></a>ä¸‰ä¸ªåˆå§‹åŒ–æ–¹æ³•</h3><ul>
<li>(instancetype)defaultPolicy;</li>
<li>(instancetype)policyWithPinningMode:(AFSSLPinningMode)pinningMode;</li>
<li>(instancetype)policyWithPinningMode:(AFSSLPinningMode)pinningMode withPinnedCertificates:(NSSet <nsdata *=""> *)pinnedCertificates;</nsdata></li>
</ul>
<h3 id="ä¸¤ä¸ªæ–¹æ³•"><a href="#ä¸¤ä¸ªæ–¹æ³•" class="headerlink" title="ä¸¤ä¸ªæ–¹æ³•"></a>ä¸¤ä¸ªæ–¹æ³•</h3><ul>
<li>(NSSet <nsdata *=""> <em>)certificatesInBundle:(NSBundle </em>)bundle;</nsdata></li>
</ul>
<ul>
<li>(BOOL)evaluateServerTrust:(SecTrustRef)serverTrust forDomain:(nullable NSString *)domain;</li>
</ul>
<p>è¿™é‡Œä¸»è¦æ¥ç€æœ€åä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸€ä¸ªServerTrustï¼Œå’Œä¸€ä¸ªdomain, è¿”å›ä¸€ä¸ªBOOLæ ‡è¯†æ˜¯å¦ä¿¡ä»»<br>é¦–å…ˆæ˜¯ä¸€ä¸ªçŸ›ç›¾ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¡éªŒè‡ªç­¾åçš„åŸŸåå¿…é¡»ä½¿ç”¨pinning mode<br>å¦‚æœéœ€è¦éªŒè¯åŸŸåï¼Œåˆ™å¢åŠ ä¸€ä¸ªåŸŸåSSLç­–ç•¥ï¼Œä¸éœ€è¦åˆ™åŠ ä¸€ä¸ªåŸºç¡€çš„BasicX509ç­–ç•¥<br>SecTrustSetPolicies ä¸ºTrustè®¾ç½®ç­–ç•¥<br>å¦‚æœModeä¸ºAFSSLPinningModeNoneï¼Œå…è®¸ä¸åˆæ³•è¯ä¹¦ç›´æ¥æŒ‰è¿”å›YES, åœ¨ç³»ç»Ÿçš„ä¿¡ä»»æœºæ„åˆ—è¡¨ä¸­éªŒè¯æ˜¯å¦åˆæ³•ã€‚<br>å¦‚æœæ˜¯ModeéNONEæƒ…å†µï¼Œä¸å…è®¸è‡ªç­¾åè¯ä¹¦ï¼Œè€ŒåˆéªŒè¯ç³»ç»Ÿä¿¡ä»»æœºæ„åˆ—è¡¨ä¸é€šè¿‡çš„ï¼Œç›´æ¥è¿”å›NO;</p>
<p>AFSSLPinningModeCertificate<br>å…ˆéªŒè¯è¯ä¹¦æ˜¯å¦okï¼Œåœ¨éªŒè¯æœ¬åœ°è¯ä¹¦æ˜¯å¦ä¸€è‡´</p>
<p>AFSSLPinningModePublicKey<br>éªŒè¯å…¬é’¥æ˜¯å¦ä¸€è‡´å³å¯ï¼Œä¸éªŒè¯è¯ä¹¦</p>
<h2 id="AFNetworkReachabilityManager"><a href="#AFNetworkReachabilityManager" class="headerlink" title="AFNetworkReachabilityManager"></a>AFNetworkReachabilityManager</h2><h3 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>networkReachabilityStatus<br>reachable<br>reachableViaWWAN<br>reachableViaWiFi</p>
<p>è¿™å‡ ä¸ªå±æ€§æœ¬è´¨éƒ½æ˜¯ç¬¬ä¸€ä¸ªå±æ€§çš„è®¡ç®—å±æ€§è€Œå·²ã€‚</p>
<h3 id="åˆå§‹åŒ–æ–¹æ³•-1"><a href="#åˆå§‹åŒ–æ–¹æ³•-1" class="headerlink" title="åˆå§‹åŒ–æ–¹æ³•"></a>åˆå§‹åŒ–æ–¹æ³•</h3><ul>
<li>(instancetype)sharedManager;</li>
<li>(instancetype)manager;</li>
<li>(instancetype)managerForDomain:(NSString *)domain;</li>
<li>(instancetype)managerForAddress:(const void *)address;</li>
</ul>
<ul>
<li>(instancetype)initWithReachability:(SCNetworkReachabilityRef)reachability NS_DESIGNATED_INITIALIZER;</li>
<li>(nullable instancetype)init NS_UNAVAILABLE;</li>
</ul>
<p>æœ¬è´¨ä¸Šéƒ½æ˜¯è·å¾—ä¸€ä¸ªreachabilityï¼Œå†…éƒ¨æŒæœ‰ï¼ˆå› ä¸ºæ˜¯corefoundationçš„å†…å®¹æ‰€ä»¥æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼‰ï¼Œç»´æŠ¤ä¸€ä¸ªstatusçš„çŠ¶æ€ã€‚</p>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><ul>
<li>(void)startMonitoring;</li>
<li>(void)stopMonitoring;</li>
<li>(NSString *)localizedNetworkReachabilityStatusString;</li>
<li>(void)setReachabilityStatusChangeBlock:(nullable void (^)(AFNetworkReachabilityStatus status))block;</li>
</ul>
<p>æœ€ç»ˆæ˜¯è°ƒç”¨SystemConfigurationä¸­SCNetworkReachabilityScheduleWithRunLoopæ¥å®Œæˆç›‘å¬ã€‚</p>
<h3 id="é€šçŸ¥"><a href="#é€šçŸ¥" class="headerlink" title="é€šçŸ¥"></a>é€šçŸ¥</h3><p>FOUNDATION_EXPORT NSString * const AFNetworkingReachabilityDidChangeNotification;</p>
<h2 id="AFURLRequestSerialization-åè®®"><a href="#AFURLRequestSerialization-åè®®" class="headerlink" title="AFURLRequestSerialization åè®®"></a>AFURLRequestSerialization åè®®</h2><h3 id="AFHTTPRequestSerializer"><a href="#AFHTTPRequestSerializer" class="headerlink" title="AFHTTPRequestSerializer"></a>AFHTTPRequestSerializer</h3><h3 id="AFPropertyListRequestSerializer"><a href="#AFPropertyListRequestSerializer" class="headerlink" title="AFPropertyListRequestSerializer"></a>AFPropertyListRequestSerializer</h3><p>æ­£å¸¸æƒ…å†µä¸‹åªæ˜¯è°ƒç”¨äº†è¿™ä¸€ä¸ªæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableURLRequest *)requestWithMethod:(NSString *)method</span><br><span class="line">                                 URLString:(NSString *)URLString</span><br><span class="line">                                parameters:(id)parameters</span><br><span class="line">                                     error:(NSError *__autoreleasing *)error</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€æ­¥ å‚æ•°æ£€æŸ¥ï¼Œæ ¹æ®URLStringç”Ÿæˆrequest, è®¾ç½®requestå¯¹åº”çš„HTTPMethod<br>ç¬¬äºŒæ­¥ å°†ä¸ä¸ºç©ºçš„å±æ€§å€¼æ·»åŠ åˆ°requestå¯¹è±¡ä¸­å»ã€‚<br>ä¸ºäº†é¿å…é‡å¤åˆ›å»ºå¯¹è±¡ï¼Œä½¿ç”¨ä¸€ä¸ªé™æ€æ•°ç»„ä¿å­˜éœ€è¦KVOçš„KeyPath AFHTTPRequestSerializerObservedKeyPaths(), åœ¨initä¸­éå†æ·»åŠ è§‚å¯Ÿè€…ã€‚<br>è¿™é‡Œæœ‰ä¸€ä¸ªå°Tipså°±æ˜¯æ·»åŠ KVOæ—¶å€™çš„context, è¿™ä¸ªcontextç”¨æ¥åˆ¤æ–­ç›¸ç­‰ã€‚è¿™é‡Œä½¿ç”¨ä¸€ä¸ªé›†åˆæ¥å­˜å‚¨å€¼ä¸ä¸ºnullçš„keypath, ä¸ºç©ºåˆ™ä»é›†åˆä¸­ç§»é™¤ã€‚<br>ç¬¬ä¸‰æ­¥ æ ¹æ®parametersç»§ç»­ç”Ÿæˆrequest, è¿™é‡Œå®ç°äº†è¿™ä¸ªåè®®çš„JSONæˆ–è€…Plistå„è‡ªå®ç°ã€‚è¿™é‡Œæˆ‘åˆ†æä½¿ç”¨è¾ƒå¤šçš„JSON</p>
<h3 id="AFJSONRequestSerializer"><a href="#AFJSONRequestSerializer" class="headerlink" title="AFJSONRequestSerializer"></a>AFJSONRequestSerializer</h3><p>ç¬¬å››æ­¥ å¦‚ä½•è¯·æ±‚æ˜¯GET HEAD DELETE åˆ™æ˜¯å°†å‚æ•°æ‹¼æ¥åˆ°URIåé¢çš„ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œè®¾ç½®headerã€‚è¿™é‡ŒsetHeaderå’ŒvalueForHeaderçš„è¯»å–éƒ½ä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æŠ€æœ¯ã€‚åœ¨ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ä¸­ä½¿ç”¨dispatch_barrier_async, dispatch_syncä¿è¯äº†è¯»å†™çš„çº¿ç¨‹å®‰å…¨ã€‚<br>å¦‚æœä¹‹å‰çš„requestä¸­æ²¡æœ‰è¿™ä¸ªheaderå°±è®¾ç½®è¿™ä¸ªé»˜è®¤çš„headerã€‚<br>å¦‚æœå­˜åœ¨è‡ªå®šä¹‰çš„è¯·æ±‚å‚æ•°åºåˆ—åŒ–å›è°ƒåˆ™ä½¿ç”¨è‡ªå®šä¹‰ï¼Œä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤çš„ï¼Œå°†parametersæ‹†æˆx=y&amp;q=eçš„å½¢å¼æ‹¼æ¥åˆ°URLä¹‹åã€‚<br>ç¬¬äº”æ­¥ å¦‚æœè¯·æ±‚æ˜¯åˆ«çš„æ–¹æ³• åˆ™æ˜¯æ ¡éªŒContent-Typeå’Œparamsæ˜¯å¦æ˜¯jsonï¼Œè½¬æˆdata, æ”¾ç½®åˆ°HTTPBodyä¸­å»ã€‚</p>
<h3 id="AFQueryStringPair"><a href="#AFQueryStringPair" class="headerlink" title="AFQueryStringPair"></a>AFQueryStringPair</h3><p>è¿™ä¸ªç±»ç”¨æ¥å®ç°urlè¯·æ±‚ï¼Ÿåé¢çš„å‚æ•°å¯¹ç±»ä¼¼â€?pageNum=1&amp;pageSize=20â€<br>AFPercentEscapedStringFromStringæ–¹æ³•çš„ç›®çš„å°±æ˜¯è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</p>
<h2 id="AFURLResponseSerialization-åè®®"><a href="#AFURLResponseSerialization-åè®®" class="headerlink" title="AFURLResponseSerialization åè®®"></a>AFURLResponseSerialization åè®®</h2><p>æ­£å¸¸æƒ…å†µä¸‹å“åº”ä¹Ÿæ˜¯ä»…ä»…èµ°è¿™ä¸ªæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (id)responseObjectForResponse:(NSURLResponse *)response</span><br><span class="line">                           data:(NSData *)data</span><br><span class="line">                          error:(NSError *__autoreleasing *)error</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€æ­¥ å‚æ•°æ£€æŸ¥, åˆæ³•å“åº”æ ¡éªŒï¼Œæ£€æŸ¥ç±»å‹ï¼Œæ£€æŸ¥MIMETypeï¼Œæ£€æŸ¥çŠ¶æ€ç 100~200<br>ç¬¬äºŒæ­¥ åˆ¤æ–­å“åº”dataæ˜¯ä¸æ˜¯ç©ºæˆ–è€…ç©ºæ ¼<br>ç¬¬ä¸‰æ­¥ è§£æjson<br>ç¬¬å››æ­¥ æ ¹æ®å‚æ•°æ˜¯å¦ç§»é™¤jsonä¸­çš„nullï¼Œç”¨ä¸€ä¸ªé€’å½’æ¥å®ç°ï¼Œå…¶ä¸­NSJSONReadingMutableContainers ç”ŸæˆmutableArray å’Œ mutableDictionary</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/27/AFNetworkingå­¦ä¹ ç¬”è®°/" data-id="ckbnff0yi000zlwj7mfinzua2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ç±»ä¼¼è‚¡ç¥¨æ•°æ®è¡¨æ ¼æ•ˆæœ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/27/ç±»ä¼¼è‚¡ç¥¨æ•°æ®è¡¨æ ¼æ•ˆæœ/" class="article-date">
  <time datetime="2017-10-27T05:57:07.000Z" itemprop="datePublished">2017-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/27/ç±»ä¼¼è‚¡ç¥¨æ•°æ®è¡¨æ ¼æ•ˆæœ/">ç±»ä¼¼è‚¡ç¥¨æ•°æ®è¡¨æ ¼æ•ˆæœ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="æ€»ç»“ä¸€ä¸‹åšä¸€ä¸ªå¤‡å¿˜"><a href="#æ€»ç»“ä¸€ä¸‹åšä¸€ä¸ªå¤‡å¿˜" class="headerlink" title="æ€»ç»“ä¸€ä¸‹åšä¸€ä¸ªå¤‡å¿˜~~"></a>æ€»ç»“ä¸€ä¸‹åšä¸€ä¸ªå¤‡å¿˜~~</h2><p>è¯¦ç»†çš„éœ€æ±‚å‚è§åŒèŠ±é¡ºç­‰è‚¡ç¥¨appï¼Œæˆ–è€…æœ‰æŠ€æœ¯ç»Ÿè®¡çš„appã€‚å·¦ä¾§ä¸€æ å›ºå®šï¼Œå³ä¾§å¤§é‡æ•°æ®å¯ä»¥æ¨ªåˆ’ï¼Œä¸Šé¢headerå¯æ‚¬æµ®ï¼Œå¯ä¸Šä¸‹æ‹‰åˆ·æ–°ã€‚</p>
<h2 id="ä¸€å¼€å§‹çš„æ€è·¯"><a href="#ä¸€å¼€å§‹çš„æ€è·¯" class="headerlink" title="ä¸€å¼€å§‹çš„æ€è·¯"></a>ä¸€å¼€å§‹çš„æ€è·¯</h2><p>æˆ‘çš„ç¬¬ä¸€æ„Ÿè§‰æ˜¯å·¦å³ä¾§æœ‰ä¸ªtableview,å³ä¾§tableviewæ”¾ç½®åœ¨scrollviewä¸Šå¯ä»¥å®Œæˆæ¨ªåˆ’æ•ˆæœã€‚ä½†æ˜¯åˆ·æ–°ä¸å¥½å¤„ç†ï¼Œæ‰‹åŠ¿ä¹Ÿè¾ƒå¤šã€‚headeræ‚¬æµ®ä¹Ÿä¸å¥½å¤„ç†</p>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p>è€ƒè™‘åˆ°headerå’Œåˆ·æ–°ï¼Œæˆ‘æƒ³æ˜¯å¦å¯ä»¥é€šè¿‡ä¸€ä¸ªtableViewæ¥å®ç°ï¼Ÿ<br>é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œé‚£ä¹ˆæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªcell, å·¦ä¾§å¯ä»¥æ˜¯å›ºå®šçš„label, å³ä¾§åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªcollectionViewã€‚äºæ˜¯è¿™é‡Œå°±æœ‰å¤šä¸ªcollectionViewåŠ åœ¨cellä¸Šçš„ã€‚<br>æ»šåŠ¨äº†ä¸€ä¸ªcellä¸­çš„collectionviewå¦‚ä½•é€šçŸ¥åˆ«çš„cellä¸­å‘¢ï¼Ÿæ˜æ˜¾è¿™æ˜¯ä¸ª1å¯¹å¤šçš„é—®é¢˜ï¼Œæ²¡é”™ï¼Œå°±æ˜¯é€šçŸ¥ã€‚åœ¨didScrollä¸­å‘é€šçŸ¥æ˜¯æ²¡é”™çš„ã€‚ä½†æ˜¯ä¸€æ—¦æ»šåŠ¨èµ·æ¥æ¯ä¸ªcelléƒ½åœ¨å‘é€šçŸ¥è‚¯å®šæ˜¯ä¸å¯¹çš„ã€‚æ‰€ä»¥æœ€å¥½æ˜¯ä½ æ»šåŠ¨çš„é‚£ä¸€ä¸ªcellå‘é€šçŸ¥ï¼Œå…¶ä»–cellæ¥å—é€šçŸ¥ã€‚è¿™é‡Œæˆ‘ç”¨ä¸€ä¸ªflagå±æ€§æ¥è®°å½•ï¼Œæˆ‘æ›¾æƒ³è¿‡ç›‘å¬collectionviewçš„contentOffsetå˜åŒ–ï¼Œç„¶åå‘é€šçŸ¥,ä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦å°±æ˜¯è¿™ä¸ªflagä¸å¥½è®¾ç½®ã€‚æœ€åæˆ‘æ‰¾åˆ°ä¸¤ä¸ªä»£ç†æ–¹æ³•ã€‚<br><code>func scrollViewWillBeginDragging(_ scrollView: UIScrollView)</code>è¿™ä¸ªæ–¹æ³•æ˜¯æ‰‹å¼€å§‹æ»‘åŠ¨è§¦å‘<br><code>func scrollViewDidEndDecelerating(_ scrollView: UIScrollView)</code>è¿™ä¸ªæ–¹æ³•æ˜¯å‡é€Ÿåœæ­¢è§¦å‘ï¼ˆå› ä¸ºæ‰‹ç¦»å¼€åï¼Œä¼šæœ‰ä¸€ä¸ªå‡é€Ÿè¿‡ç¨‹ï¼Œcontentoffsetè¿˜æ˜¯ä¼šå˜åŒ–ï¼‰<br>æˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„æ˜¯æˆ‘ä»¬æ»‘åŠ¨çš„é‚£ä¸ªcellä¸­çš„collectionViewçš„contentOffsetçš„å˜åŒ–ï¼Œä¸æ˜¯å—?kvoæ— æ³•åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸»åŠ¨æ»‘åŠ¨çš„cell,ä¼šå¯¼è‡´å¤ªå¤šçš„cellåœ¨å‘é€šçŸ¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">private var flag = false</span><br><span class="line"></span><br><span class="line">override func awakeFromNib() &#123;</span><br><span class="line">    super.awakeFromNib()</span><br><span class="line">    NotificationCenter.default.addObserver(self, selector: #selector(offsetChange(_:)), name: NSNotification.Name.offsetChange, object: nil)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@objc func offsetChange(_ notification: Notification)&#123;</span><br><span class="line">    if let object = notification.object as? CustomTableViewCell, object === self &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    if let object = notification.object as? CustomHeaderView, object === self &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    collectionView.setContentOffset(notification.userInfo![&quot;offset&quot;] as! CGPoint, animated: false)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func scrollViewWillBeginDragging(_ scrollView: UIScrollView) &#123;</span><br><span class="line">    self.flag = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func scrollViewDidEndDecelerating(_ scrollView: UIScrollView) &#123;</span><br><span class="line">    self.flag = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func scrollViewDidScroll(_ scrollView: UIScrollView) &#123;</span><br><span class="line">    if self.flag &#123;</span><br><span class="line">        NotificationCenter.default.post(name: NSNotification.Name.offsetChange, object: self, userInfo: [&quot;offset&quot;: scrollView.contentOffset])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/10/27/ç±»ä¼¼è‚¡ç¥¨æ•°æ®è¡¨æ ¼æ•ˆæœ/" data-id="ckbnff0y5000ulwj7a1xyuuv1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-OCä¹‹äº‹ä»¶ä¼ é€’å“åº”é“¾" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/12/OCä¹‹äº‹ä»¶ä¼ é€’å“åº”é“¾/" class="article-date">
  <time datetime="2017-10-12T07:19:41.000Z" itemprop="datePublished">2017-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/12/OCä¹‹äº‹ä»¶ä¼ é€’å“åº”é“¾/">OCä¹‹äº‹ä»¶ä¼ é€’å“åº”é“¾</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="hitTest"><a href="#hitTest" class="headerlink" title="hitTest"></a>hitTest</h2><p>è¿™é‡Œyyäº†ä¸€ä¸‹ç³»ç»Ÿé»˜è®¤çš„å®ç°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event &#123;</span><br><span class="line">    if (!self.isUserInteractionEnabled || self.isHidden || self.alpha &lt;= 0.01) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    if ([self pointInside:point withEvent:event]) &#123; // å†…éƒ¨ä¼šè°ƒç”¨pointInsideæ–¹æ³•</span><br><span class="line">        for (UIView *subview in [self.subviews reverseObjectEnumerator]) &#123;// åå‘éå†ï¼Œè¿™æ ·å³ä½¿é‡å ä¹Ÿä¼šä¼˜å…ˆå¤„ç†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªhitTestçš„å­è§†å›¾ï¼Œæ‰¾ä¸åˆ°å°±æ˜¯è‡ªèº«</span><br><span class="line">            CGPoint convertedPoint = [subview convertPoint:point fromView:self];</span><br><span class="line">            UIView *hitTestView = [subview hitTest:convertedPoint withEvent:event];</span><br><span class="line">            if (hitTestView) &#123;</span><br><span class="line">                return hitTestView;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return self;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="pointInside"><a href="#pointInside" class="headerlink" title="pointInside"></a>pointInside</h2><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><ol>
<li>æ‰©å¤§UIButtonçš„ç‚¹å‡»åŒºåŸŸ</li>
<li>å­viewè¶…å‡ºäº†çˆ¶viewçš„boundså“åº”äº‹ä»¶ï¼ˆçˆ¶viewä¸å»åˆ¤æ–­point insideç›´æ¥éå†subViewï¼‰</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/10/12/OCä¹‹äº‹ä»¶ä¼ é€’å“åº”é“¾/" data-id="ckbnff0xl000dlwj770majyof" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOSä¹‹HTTP-HTTPS-TCP-UDP-DNS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/11/iOSä¹‹HTTP-HTTPS-TCP-UDP-DNS/" class="article-date">
  <time datetime="2017-10-11T09:01:10.000Z" itemprop="datePublished">2017-10-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/11/iOSä¹‹HTTP-HTTPS-TCP-UDP-DNS/">iOSä¹‹HTTP,HTTPS,TCP,UDP,DNS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>get, post, head, put ,delete ç­‰æ–¹æ³•<br>request header<br>request body</p>
<p>response code<br>response header<br>response body</p>
<h2 id="https"><a href="#https" class="headerlink" title="https"></a>https</h2><p>ç›¸å¯¹äºhttpå¤šäº†ä¸€ä¸ªTLSåŠ å¯†å±‚ï¼Œç›®çš„æ˜¯åŠ å¯†ã€å®Œæ•´æ€§æ ¡éªŒä»¥åŠèº«ä»½è®¤è¯</p>
<p>å¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹</p>
<ol>
<li>å®¢æˆ·ç«¯å‘èµ·HTTPSè¯·æ±‚</li>
<li>æœåŠ¡ç«¯çš„é…ç½® ï¼ˆç”Ÿæˆå…¬é’¥ç§é’¥ï¼‰</li>
<li>ä¼ é€è¯ä¹¦ï¼ˆè¯ä¹¦ç›¸å½“äºå…¬é’¥ï¼‰</li>
<li>å®¢æˆ·ç«¯è§£æè¯ä¹¦ï¼ˆå…±å…¬é’¥åŠ å¯†ä¸€ä¸ªéšæœºæ•°ï¼‰</li>
<li>ä¼ é€åŠ å¯†ä¿¡æ¯ï¼ˆå‘ç»™æœåŠ¡ç«¯ï¼‰</li>
<li>æœåŠ¡ç«¯è§£å¯†ä¿¡æ¯ï¼ˆè·å¾—éšæœºæ•°ï¼‰</li>
<li>ä¼ è¾“åŠ å¯†åçš„ä¿¡æ¯ï¼ˆç”¨è¿™ä¸ªéšæœºæ•°åŠ å¯†åä¼ ç»™å®¢æˆ·ç«¯ï¼‰</li>
<li>å®¢æˆ·ç«¯è§£å¯†ä¿¡æ¯</li>
</ol>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>TCPé€šè¿‡æ ¡éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡å‘æ§åˆ¶ã€è¿æ¥ç®¡ç†ä»¥åŠçª—å£æ§åˆ¶ç­‰æœºåˆ¶å®ç°å¯é æ€§ä¼ è¾“ã€‚</p>
<h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><ol>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥ã€‚å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå°†SYNä½ç½®ä¸º1ï¼ŒSequence Numberä¸ºxï¼›ç„¶åï¼Œå®¢æˆ·ç«¯è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨çš„ç¡®è®¤ï¼›</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°SYNæŠ¥æ–‡æ®µã€‚æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡æ®µï¼Œéœ€è¦å¯¹è¿™ä¸ªSYNæŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤ï¼Œè®¾ç½®Acknowledgment Numberä¸ºx+1(Sequence Number+1)ï¼›åŒæ—¶ï¼Œè‡ªå·±è‡ªå·±è¿˜è¦å‘é€SYNè¯·æ±‚ä¿¡æ¯ï¼Œå°†SYNä½ç½®ä¸º1ï¼ŒSequence Numberä¸ºyï¼›æœåŠ¡å™¨ç«¯å°†ä¸Šè¿°æ‰€æœ‰ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆå³SYN+ACKæŠ¥æ–‡æ®µï¼‰ä¸­ï¼Œä¸€å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKæŠ¥æ–‡æ®µã€‚ç„¶åå°†Acknowledgment Numberè®¾ç½®ä¸ºy+1ï¼Œå‘æœåŠ¡å™¨å‘é€ACKæŠ¥æ–‡æ®µï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µå‘é€å®Œæ¯•ä»¥åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹ã€‚<br>å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å°±å¯ä»¥å¼€å§‹ä¼ é€æ•°æ®ã€‚ä»¥ä¸Šå°±æ˜¯TCPä¸‰æ¬¡æ¡æ‰‹çš„æ€»ä½“ä»‹ç»ã€‚</li>
</ol>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>æ— éœ€å»ºç«‹è¿æ¥ï¼ˆå‡å°‘å»¶è¿Ÿ</p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>åŸŸåè§£ææœåŠ¡</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/10/11/iOSä¹‹HTTP-HTTPS-TCP-UDP-DNS/" data-id="ckbnff0xy000olwj7337elvg2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-OCä¹‹å±æ€§å…³é”®å­—" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/29/OCä¹‹å±æ€§å…³é”®å­—/" class="article-date">
  <time datetime="2017-09-29T05:47:39.000Z" itemprop="datePublished">2017-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/29/OCä¹‹å±æ€§å…³é”®å­—/">OCä¹‹å±æ€§å…³é”®å­—</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="assgin"><a href="#assgin" class="headerlink" title="assgin"></a>assgin</h2><p>assgin ç”¨äºçº¯é‡å±æ€§ï¼Œä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ä¸è¦ç”¨æ¥ä¿®é¥°å¯¹è±¡ï¼Œå› ä¸ºå¯¹è±¡é‡Šæ”¾åï¼Œassginä¿®é¥°çš„å˜é‡ä¸ä¼šç½®ä¸ºnilï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡æŒ‡é’ˆé”™è¯¯ï¼</p>
<h2 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h2><p>ç”¨äºå¯¹è±¡ä¸ä½¿retainCountå¢åŠ ï¼Œå¯¹è±¡é‡Šæ”¾åä¼šç½®ä¸ºnilã€‚</p>
<blockquote>
<p>runtime å¯¹æ³¨å†Œçš„ç±»ï¼Œä¼šè¿›è¡Œå¸ƒå±€ï¼Œå¯¹äºweakå¯¹è±¡ä¼šæ”¾å…¥ä¸€ä¸ªhashè¡¨ä¸­ã€‚ç”¨weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€ä½œä¸ºkeyï¼Œå½“æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ä¼šdeallocï¼Œå‡å¦‚weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯aï¼Œé‚£ä¹ˆå°±ä¼šä»¥aä¸ºé”®ï¼Œåœ¨è¿™ä¸ªweakè¡¨ä¸­æœç´¢ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»¥aä¸ºé”®çš„weakå¯¹è±¡ï¼Œä»è€Œè®¾ç½®ä¸ºnilã€‚åä¹‹å¦‚æœå¯¹è±¡æœ¬èº«å…ˆé‡Šæ”¾ï¼Œåˆ™å°†å…¶ä»tableä¸­åˆ é™¤ã€‚</p>
</blockquote>
<h2 id="strong"><a href="#strong" class="headerlink" title="strong"></a>strong</h2><p>ç”¨äºå¯¹è±¡ä¼šä½¿retainCount å¢åŠ </p>
<h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><p>åŒºåˆ«åœ¨setæ–¹æ³•ä¸ç”¨ã€‚<br>Blockä¸ºä»€ä¹ˆç”¨Copy</p>
<blockquote>
<p>Note: You should specify copy as the property attribute, because a block needs to be copied to keep track of its captured state outside of the original scope. This isnâ€™t something you need to worry about when using Automatic Reference Counting, as it will happen automatically, but itâ€™s best practice for the property attribute to show the resultant behavior. For more information, see Blocks Programming Topics.</p>
</blockquote>
<h2 id="atomic"><a href="#atomic" class="headerlink" title="atomic"></a>atomic</h2><p>åŸå­æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (UITextField *) userName &#123;</span><br><span class="line">    UITextField *retval = nil;</span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">        retval = [[userName retain] autorelease];</span><br><span class="line">    &#125;</span><br><span class="line">    return retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void) setUserName:(UITextField *)userName_ &#123;</span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">      [userName release];</span><br><span class="line">      userName = [userName_ retain];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nonatomic"><a href="#nonatomic" class="headerlink" title="nonatomic"></a>nonatomic</h2><p>éåŸå­æ€§</p>
<h2 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h2><p>åªè¯»ï¼Œä¸åˆæˆsetæ–¹æ³•</p>
<h2 id="nullable"><a href="#nullable" class="headerlink" title="nullable"></a>nullable</h2><p>å¯ä»¥ä¸ºnil å¯¹åº”Swiftçš„optional</p>
<h2 id="nonnull"><a href="#nonnull" class="headerlink" title="nonnull"></a>nonnull</h2><p>ä¸å¯ä»¥ä¸ºnil å¯¹åº”Swiftçš„non optional</p>
<h2 id="ViewControllerçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ViewControllerçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ViewControllerçš„ç”Ÿå‘½å‘¨æœŸ"></a>ViewControllerçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>First viewDidLoad       //1<br>First viewWillAppear    //2<br>First viewDidAppear     //3<br>â€”Click Push<br>First viewWillDisappear //4<br>Second viewDidLoad      //5<br>Second viewWillAppear   //6<br>â€”Push Finish<br>First viewDidDisappear  //7<br>Second viewDidAppear    //8<br>â€”Click Pop<br>Second viewWillDisappear//9<br>First viewWillAppear    //10<br>â€”Pop Finish<br>Second viewDidDisappear //11<br>First viewDidAppear     //12</p>
<h2 id="Autolayoutçš„è¿‡ç¨‹"><a href="#Autolayoutçš„è¿‡ç¨‹" class="headerlink" title="Autolayoutçš„è¿‡ç¨‹"></a>Autolayoutçš„è¿‡ç¨‹</h2><p>(setNeedUpdateConstraints,updateConstraintsIfNeeded)-&gt;updateConstraints<br>(setNeedsLayout,layoutIfNeeded)-&gt; layoutSubViews<br>-&gt; drawRect</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/29/OCä¹‹å±æ€§å…³é”®å­—/" data-id="ckbnff0xn000elwj7in3nhvd6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-OCä¹‹æ¶ˆæ¯ä¸è½¬å‘" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/28/OCä¹‹æ¶ˆæ¯ä¸è½¬å‘/" class="article-date">
  <time datetime="2017-09-28T07:22:38.000Z" itemprop="datePublished">2017-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/28/OCä¹‹æ¶ˆæ¯ä¸è½¬å‘/">OCä¹‹æ¶ˆæ¯ä¸è½¬å‘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h2><p>å½“æˆ‘åˆšå­¦ä¹ çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—æ–¹æ³•å’Œå‡½æ•°æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚é‚£æ—¶å€™too young too simpleã€‚<br>åæ¥æˆ‘å­¦äº†ä¸€ç‚¹ï¼Œæˆ‘ä»¥ä¸ºå±äºç±»çš„å°±æ˜¯æ–¹æ³•ã€‚ä¹Ÿå¯¹ä¸å¤ªå¯¹ã€‚åœ¨OCä¸­è°ƒç”¨æ–¹æ³•å…¶å®æ˜¯å‘æ¶ˆæ¯objc_msgSendã€‚å‡½æ•°åˆ™æ˜¯ç›´æ¥æ‰§è¡Œã€‚</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>è¯¦è§objc-runtime-new.mm</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Method <span class="title">class_getInstanceMethod</span><span class="params">(Class cls, SEL sel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cls  ||  !sel) <span class="keyword">return</span> nil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This deliberately avoids +initialize because it historically did so.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// This implementation is a bit weird because it's the only place that </span></span><br><span class="line">    <span class="comment">// wants a Method instead of an IMP.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">warning</span> fixme build and search caches</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// Search method lists, try method resolver, etc.</span></span><br><span class="line">    lookUpImpOrNil(cls, sel, nil, </span><br><span class="line">                   NO<span class="comment">/*initialize*/</span>, NO<span class="comment">/*cache*/</span>, YES<span class="comment">/*resolver*/</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">warning</span> fixme build and search caches</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _class_getMethod(cls, sel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">IMP <span class="title">lookUpImpOrNil</span><span class="params">(Class cls, SEL sel, id inst, </span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">bool</span> initialize, <span class="keyword">bool</span> cache, <span class="keyword">bool</span> resolver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    IMP imp = lookUpImpOrForward(cls, sel, inst, initialize, cache, resolver);</span><br><span class="line">    <span class="keyword">if</span> (imp == _objc_msgForward_impcache) <span class="keyword">return</span> nil;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> imp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">IMP <span class="title">lookUpImpOrForward</span><span class="params">(Class cls, SEL sel, id inst, </span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">bool</span> initialize, <span class="keyword">bool</span> cache, <span class="keyword">bool</span> resolver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Class curClass;</span><br><span class="line">    IMP imp = nil;</span><br><span class="line">    Method meth;</span><br><span class="line">    <span class="keyword">bool</span> triedResolver = NO;</span><br><span class="line"></span><br><span class="line">    runtimeLock.assertUnlocked();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Optimistic cache lookup</span></span><br><span class="line">    <span class="keyword">if</span> (cache) &#123;</span><br><span class="line">        imp = cache_getImp(cls, sel);   <span class="comment">//0. æ ¹æ®Classå’ŒSELåœ¨cacheä¸­å¯»æ‰¾IMP</span></span><br><span class="line">        <span class="keyword">if</span> (imp) <span class="keyword">return</span> imp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cls-&gt;isRealized()) &#123;           <span class="comment">//1. Classæ²¡æœ‰å®ç°ï¼Œå®ç°è¿™ä¸ªClass</span></span><br><span class="line">        <span class="keyword">rwlock_writer_t</span> lock(runtimeLock);</span><br><span class="line">        realizeClass(cls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (initialize  &amp;&amp;  !cls-&gt;isInitialized()) &#123;<span class="comment">//2. Classæ²¡æœ‰Initailize,ä¹Ÿå°±æ˜¯è¯´åœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™Initializeè¿™ä¸ªClass</span></span><br><span class="line">        _class_initialize (_class_getNonMetaClass(cls, inst));</span><br><span class="line">        <span class="comment">// If sel == initialize, _class_initialize will send +initialize and </span></span><br><span class="line">        <span class="comment">// then the messenger will send +initialize again after this </span></span><br><span class="line">        <span class="comment">// procedure finishes. Of course, if this is not being called </span></span><br><span class="line">        <span class="comment">// from the messenger then it won't happen. 2778172</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The lock is held to make method-lookup + cache-fill atomic </span></span><br><span class="line">    <span class="comment">// with respect to method addition. Otherwise, a category could </span></span><br><span class="line">    <span class="comment">// be added but ignored indefinitely because the cache was re-filled </span></span><br><span class="line">    <span class="comment">// with the old value after the cache flush on behalf of the category.</span></span><br><span class="line"> retry:</span><br><span class="line">    runtimeLock.read();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try this class's cache.</span></span><br><span class="line"></span><br><span class="line">    imp = cache_getImp(cls, sel);<span class="comment">//3. åœ¨è‡ªèº«çš„ç±»ç¼“å­˜ä¸­æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">if</span> (imp) <span class="keyword">goto</span> done;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try this class's method lists.</span></span><br><span class="line"></span><br><span class="line">    meth = getMethodNoSuper_nolock(cls, sel);<span class="comment">//4. åœ¨è‡ªèº«çš„ç±»ä¸­æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">if</span> (meth) &#123;</span><br><span class="line">        log_and_fill_cache(cls, meth-&gt;imp, sel, inst, cls);<span class="comment">//5. æ·»åŠ åˆ°ç¼“å­˜</span></span><br><span class="line">        imp = meth-&gt;imp;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try superclass caches and method lists.</span></span><br><span class="line"></span><br><span class="line">    curClass = cls;</span><br><span class="line">    <span class="keyword">while</span> ((curClass = curClass-&gt;superclass)) &#123;</span><br><span class="line">        <span class="comment">// Superclass cache.</span></span><br><span class="line">        imp = cache_getImp(curClass, sel);<span class="comment">// 6. çˆ¶ç±»ç¼“å­˜ä¸­æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (imp) &#123;</span><br><span class="line">            <span class="keyword">if</span> (imp != (IMP)_objc_msgForward_impcache) &#123;</span><br><span class="line">                <span class="comment">// Found the method in a superclass. Cache it in this class.</span></span><br><span class="line">                log_and_fill_cache(cls, imp, sel, inst, curClass);</span><br><span class="line">                <span class="keyword">goto</span> done;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Found a forward:: entry in a superclass.</span></span><br><span class="line">                <span class="comment">// Stop searching, but don't cache yet; call method </span></span><br><span class="line">                <span class="comment">// resolver for this class first.</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Superclass method list.</span></span><br><span class="line">        meth = getMethodNoSuper_nolock(curClass, sel);<span class="comment">// çˆ¶ç±»ä¸­æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (meth) &#123;</span><br><span class="line">            log_and_fill_cache(cls, meth-&gt;imp, sel, inst, curClass);<span class="comment">// æ·»åŠ åˆ°è‡ªèº«çš„ç¼“å­˜</span></span><br><span class="line">            imp = meth-&gt;imp;</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// No implementation found. Try method resolver once.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resolver  &amp;&amp;  !triedResolver) &#123;</span><br><span class="line">        runtimeLock.unlockRead();</span><br><span class="line">        _class_resolveMethod(cls, sel, inst);<span class="comment">// æ¶ˆæ¯è½¬å‘ å†…éƒ¨åˆ¤æ–­ä¸æ˜¯å…ƒç±»è°ƒç”¨resolveInstanceMethod, æ˜¯å…ƒç±»è°ƒç”¨resolveClassMethod</span></span><br><span class="line">        <span class="comment">// Don't cache the result; we don't hold the lock so it may have </span></span><br><span class="line">        <span class="comment">// changed already. Re-do the search from scratch instead.</span></span><br><span class="line">        triedResolver = YES;</span><br><span class="line">        <span class="keyword">goto</span> retry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// No implementation found, and method resolver didn't help. </span></span><br><span class="line">    <span class="comment">// Use forwarding.</span></span><br><span class="line"></span><br><span class="line">    imp = (IMP)_objc_msgForward_impcache;</span><br><span class="line">    cache_fill(cls, sel, imp, inst);</span><br><span class="line"></span><br><span class="line"> done:</span><br><span class="line">    runtimeLock.unlockRead();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> imp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‘æ¶ˆæ¯çš„æµç¨‹"><a href="#å‘æ¶ˆæ¯çš„æµç¨‹" class="headerlink" title="å‘æ¶ˆæ¯çš„æµç¨‹"></a>å‘æ¶ˆæ¯çš„æµç¨‹</h2><ol>
<li>æ ¹æ®Classå’ŒSELåœ¨ç¼“å­˜ä¸­å¯»æ‰¾IMP, æ‰¾åˆ°ç›´æ¥return imp</li>
<li>åˆ¤æ–­Classæ˜¯å¦å®ç°ï¼Œæ˜¯å¦initializeï¼Œæ ¹æ®Class methodlistä¸­ï¼Œå¯»æ‰¾SELçš„IMPï¼Œæ‰¾åˆ°æ·»åŠ cache, return imp</li>
<li>åˆ°çˆ¶ç±»ä¸­æ‰¾, å…ˆcache, å†methods, æ·»åŠ cacheï¼ˆçœ‹æºç å¥½åƒæ˜¯æ·»åŠ åˆ°å½“å‰ç±»çš„cache, å¦‚æœå†è°ƒç”¨çˆ¶ç±»ï¼‰</li>
<li>éƒ½æ²¡æ‰¾åˆ°æ‰§è¡Œ_objc_msgForward</li>
<li>_objc_msgForward_impcache</li>
</ol>
<h2 id="è½¬å‘æµç¨‹"><a href="#è½¬å‘æµç¨‹" class="headerlink" title="è½¬å‘æµç¨‹"></a>è½¬å‘æµç¨‹</h2><p>ç»“åˆNSObjectæ–‡æ¡£å¯ä»¥çŸ¥é“ï¼Œ_objc_msgForwardæ¶ˆæ¯è½¬å‘åšäº†å¦‚ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>è°ƒç”¨resolveInstanceMethod:æ–¹æ³•ï¼Œå…è®¸ç”¨æˆ·åœ¨æ­¤æ—¶ä¸ºè¯¥ClassåŠ¨æ€æ·»åŠ å®ç°ã€‚å¦‚æœæœ‰å®ç°äº†ï¼Œåˆ™è°ƒç”¨å¹¶è¿”å›ã€‚å¦‚æœä»æ²¡å®ç°ï¼Œç»§ç»­ä¸‹é¢çš„åŠ¨ä½œã€‚</li>
<li>è°ƒç”¨forwardingTargetForSelector:æ–¹æ³•ï¼Œå°è¯•æ‰¾åˆ°ä¸€ä¸ªèƒ½å“åº”è¯¥æ¶ˆæ¯çš„å¯¹è±¡ã€‚å¦‚æœè·å–åˆ°ï¼Œåˆ™ç›´æ¥è½¬å‘ç»™å®ƒã€‚å¦‚æœè¿”å›äº†nilï¼Œç»§ç»­ä¸‹é¢çš„åŠ¨ä½œã€‚</li>
<li>è°ƒç”¨methodSignatureForSelector:æ–¹æ³•ï¼Œå°è¯•è·å¾—ä¸€ä¸ªæ–¹æ³•ç­¾åã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™ç›´æ¥è°ƒç”¨doesNotRecognizeSelectoræŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>è°ƒç”¨forwardInvocation:æ–¹æ³•ï¼Œå°†åœ°3æ­¥è·å–åˆ°çš„æ–¹æ³•ç­¾ååŒ…è£…æˆInvocationä¼ å…¥ï¼Œå¦‚ä½•å¤„ç†å°±åœ¨è¿™é‡Œé¢äº†</li>
</ol>
<p>Tips ==&gt; TypeCoding<br>â€œv@:â€ // ä¾æ¬¡ä¸ºè¿”å›å€¼ï¼Œself, SEL, å‚æ•°åˆ—è¡¨ã€‚ vä»£è¡¨è¿”å›å€¼ä¸ºvoidï¼›@ä»£è¡¨å‚æ•°å¯¹è±¡ç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸ºæ¶ˆæ¯è½¬å‘çš„å¯¹è±¡ï¼›ï¼šä»£è¡¨å‚æ•°ä¸ºSELç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸ºæ¶ˆæ¯è½¬å‘çš„SEL;</p>
<h2 id="NSInvocation"><a href="#NSInvocation" class="headerlink" title="NSInvocation"></a>NSInvocation</h2><p>NSInvocationå¯¹äºå‚æ•°&gt;2ä¸ªæˆ–è€…æœ‰è¿”å›å€¼çš„å¤„ç†çš„å°è£…</p>
<ol>
<li>ç±»æ–¹æ³•åˆ›å»º, NSMethodSignatureç”±æ–¹æ³•å±äºçš„ç±»åˆ›å»ºã€‚</li>
</ol>
<ul>
<li>(NSInvocation <em>)invocationWithMethodSignature:(NSMethodSignature </em>)sig;</li>
</ul>
<ol>
<li><p>æŒ‡å®šobjæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¹‹å‰å¯ä»¥è®¾ç½®å‚æ•°ã€‚<br>[invocation invokeWithTarget: obj];</p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2></li>
<li><p>@dynamic å±æ€§</p>
</li>
<li>å¤šç»§æ‰¿</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/28/OCä¹‹æ¶ˆæ¯ä¸è½¬å‘/" data-id="ckbnff0xo000flwj7pe0pcevl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/20/å¸¸è§iOSUIæ–¹æ¡ˆ/">å¸¸è§iOSUIæ–¹æ¡ˆ</a>
          </li>
        
          <li>
            <a href="/2019/11/16/è®°ä¸€æ¬¡MethodSwizzleçš„bugfix/">è®°ä¸€æ¬¡MethodSwizzleçš„bugfix</a>
          </li>
        
          <li>
            <a href="/2019/10/27/MacBook-Pro-Retina-13-inch-Early-2015-æ›´æ¢ssd/">MacBook Pro(Retina, 13-inch, Early 2015)æ›´æ¢ssd</a>
          </li>
        
          <li>
            <a href="/2019/10/16/iOSè¯ä¹¦å’Œæ¨é€/">iOSè¯ä¹¦å’Œæ¨é€</a>
          </li>
        
          <li>
            <a href="/2019/06/06/CocoaPods/">CocoaPods</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 hust_destiny<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>